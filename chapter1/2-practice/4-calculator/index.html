<!DOCTYPE html>
<html lang="fr" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="">


    <link rel="icon" href="/CPP_Learning/images/favicon.png" type="image/png">

    <title>ðŸ§® Calculette :: Cours de C&#43;&#43; - Niveau Master</title>

    
    <link href="/CPP_Learning/css/nucleus.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/fontawesome-all.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/hybrid.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/featherlight.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/perfect-scrollbar.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/auto-complete.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/atom-one-dark-reasonable.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/theme.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/hugo-theme.css?1641495013" rel="stylesheet">
    
    <link href="/CPP_Learning/css/theme-mine.css?1641495013" rel="stylesheet">
    
    <link href="/CPP_Learning/css/syntax.css?1641495013" rel="stylesheet">

    <script src="/CPP_Learning/js/jquery-3.3.1.min.js?1641495013"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/CPP_Learning/chapter1/2-practice/4-calculator/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://laefy.github.io/CPP_Learning/">ðŸŽ„ C++ ðŸŽ„</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Rechercher...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/CPP_Learning/js/lunr.min.js?1641495013"></script>
<script type="text/javascript" src="/CPP_Learning/js/auto-complete.js?1641495013"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/laefy.github.io\/CPP_Learning\/";
    
</script>
<script type="text/javascript" src="/CPP_Learning/js/search.js?1641495013"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter0/" title="Mise en place" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter0/">
          <b>0- </b>Mise en place
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/1-compiler/" title="Compilateur" class="dd-item ">
        <a href="/CPP_Learning/chapter0/1-compiler/">
        Compilateur
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/2-vscode/" title="Visual Studio Code" class="dd-item ">
        <a href="/CPP_Learning/chapter0/2-vscode/">
        Visual Studio Code
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/3-cmake/" title="CMake" class="dd-item ">
        <a href="/CPP_Learning/chapter0/3-cmake/">
        CMake
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/4-git/" title="Git" class="dd-item ">
        <a href="/CPP_Learning/chapter0/4-git/">
        Git
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/5-clang-format/" title="Clang-Format" class="dd-item ">
        <a href="/CPP_Learning/chapter0/5-clang-format/">
        Clang-Format
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/6-tips/" title="Astuces" class="dd-item ">
        <a href="/CPP_Learning/chapter0/6-tips/">
        Astuces
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/test/" title="Retours ?" class="dd-item ">
        <a href="/CPP_Learning/chapter0/test/">
        Retours ?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/" title="Introduction au C&#43;&#43;" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter1/">
          <b>1- </b>Introduction au C&#43;&#43;
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/1-language/" title="PrÃ©sentation du langage" class="dd-item ">
        <a href="/CPP_Learning/chapter1/1-language/">
        PrÃ©sentation du langage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/2-practice/" title="Premiers programmes" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter1/2-practice/">
          Premiers programmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/1-hello-world/" title="ðŸ‘‹ Hello World" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/1-hello-world/">
        ðŸ‘‹ Hello World
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/2-parrot/" title="ðŸ¦œ Perroquet" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/2-parrot/">
        ðŸ¦œ Perroquet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/3-array/" title="ðŸ”¢ Tableau NumÃ©rique" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/3-array/">
        ðŸ”¢ Tableau NumÃ©rique
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/4-calculator/" title="ðŸ§® Calculette" class="dd-item active">
        <a href="/CPP_Learning/chapter1/2-practice/4-calculator/">
        ðŸ§® Calculette
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter1/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/summary/" title="SynthÃ¨se" class="dd-item ">
        <a href="/CPP_Learning/chapter1/summary/">
        SynthÃ¨se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>AccÃ¨s rapide</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/Laefy/CPP_Learning_Code/"><i class='fab fa-github'></i> DÃ©pÃ´t GitHub</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/workflow"><i class='far fa-list-alt'></i> Workflow</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/faq"><i class='fas fa-question-circle'></i> FAQ</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/chapter0/6-tips/"><i class='fa fa-rocket'></i> Astuces</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://en.cppreference.com/w/"><i class='fas fa-passport'></i> CPP-Ref</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Supprimer l&#39;historique</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/CPP_Learning/'>Accueil</a> > <a href='/CPP_Learning/chapter1/'>Introduction au C++</a> > <a href='/CPP_Learning/chapter1/2-practice/'>Premiers programmes</a> > ðŸ§® Calculette
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#comprendre-le-code-existant">Comprendre le code existant</a></li>
        <li><a href="#extraction-de-chaque-Ã©tape-dans-des-fonctions">Extraction de chaque Ã©tape dans des fonctions</a></li>
        <li><a href="#les-rÃ©fÃ©rences">Les rÃ©fÃ©rences</a></li>
        <li><a href="#switch-">Switch !</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              ðŸ§® Calculette
            </h1>
          

        


<p>Dans cet exercice, vous refactoriserez le code d&rsquo;une mini-calculette. Cela sera l&rsquo;occasion de voir l&rsquo;instruction switch, les fonctions et le passage de paramÃ¨tres par rÃ©fÃ©rence.</p>
<hr>
<p>Pour cet exercice, vous modifierez le fichier :<br>
- <code>chap-01/4-calculator.cpp</code></p>
<p>La cible Ã  compiler est <code>c1-4-calculator</code>.</p>
<hr>
<h3 id="comprendre-le-code-existant">Comprendre le code existant</h3>
<p>CommenÃ§ons par parcourir le code fourni, afin de comprendre ce qu&rsquo;il s&rsquo;y passe.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Output result.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>DÃ©jÃ , en regardant les commentaires, on se rend compte que le programme comporte 3 Ã©tapes :</p>
<ol>
<li>Traitement des arguments</li>
<li>Calcul de l&rsquo;opÃ©ration</li>
<li>Affichage du rÃ©sultat</li>
</ol>
<p>Nous allons analyser le code de chacune de ces Ã©tapes.</p>
<h4 id="traitement-des-arguments">Traitement des arguments</h4>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator as first argument.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Ce premier <code>if</code> est plutÃ´t simple Ã  comprendre. Le programme attend pour premier argument un opÃ©rateur, donc si on a moins d&rsquo;un argument (2 car <code>argv[0]</code> est le nom de la commande), on s&rsquo;arrÃªte.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">op</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</code></pre></div><p>L&rsquo;expression <code>argv[1]</code>, c&rsquo;est-Ã -dire ce que l&rsquo;on s&rsquo;attend Ã  Ãªtre l&rsquo;opÃ©rateur, est placÃ©e dans une <code>std::string</code>. Ecrire cette instruction a deux avantages :<br>
- dÃ©jÃ , cela permet d&rsquo;avoir un nom de variable un peu plus explicite que &lsquo;argv[1]&rsquo;, et donc de rendre le code plus clair,<br>
- ensuite, on se retrouve avec une variable de type <code>std::string</code> plutÃ´t que <code>char*</code>. Or, si on fait <code>==</code> entre deux <code>std::string</code>, on compare bien les chaÃ®nes de caractÃ¨res, alors que si on fait <code>==</code> entre deux <code>char*</code>, on compare en fait deux adresses en mÃ©moire (<code>char*</code> n&rsquo;Ã©tant qu&rsquo;un pointeur).

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;+&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;*&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator to be &#39;+&#39;, &#39;*&#39; or &#39;-&#39;.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Le programme ne supportant que les additions, multiplications ou soustractions, on s&rsquo;arrÃªte si l&rsquo;opÃ©rateur ne correspond pas Ã  l&rsquo;une de ces trois opÃ©rations.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">arg_i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">arg_i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">arg_i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">arg_i</span><span class="p">]);</span>
    <span class="n">values</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div><p>Un tableau de valeurs est dÃ©fini, et il est rempli avec les arguments donnÃ©s au programme Ã  la suite de l&rsquo;opÃ©rateur. <code>std::stoi</code> est utilisÃ©e pour convertir les chaÃ®nes en entiers.<br>
La seule chose un peu Ã©tonnante ici, c&rsquo;est l&rsquo;utilisation de <code>auto</code> Ã  la place de <code>int</code>. En fait, <code>auto</code> permet de ne pas avoir Ã  spÃ©cifier en permanence les types que l&rsquo;on manipule lorsque le compilateur peut les dÃ©duire par lui-mÃªme. Ici, en Ã©crivant <code>auto arg_i = 2</code>, le compilateur est capable de dÃ©terminer que <code>arg_i</code> est de type <code>int</code>, puisqu&rsquo;on l&rsquo;initialise avec 2. Dans la ligne suivante, le compilateur est Ã©galement capable de dÃ©duire tout seul que <code>value</code> sera de type <code>int</code>, car la fonction <code>stoi</code> retourne un rÃ©sultat de type <code>int</code>.</p>

<div class="notices note" ><p>Certaines personnes n&rsquo;aiment pas utiliser <code>auto</code>, car elles trouvent que cela rend le code moins clair. C&rsquo;est effectivement l&rsquo;un des inconvÃ©nients, surtout si l&rsquo;on n&rsquo;utilise pas d&rsquo;IDE. Si on utilise un IDE, ce problÃ¨me est quasiment inexistant, puisqu&rsquo;il suffit gÃ©nÃ©ralement de passer son curseur au-dessus du nom de la variable pour obtenir le vrai type.<br>
Personnellement, j&rsquo;apprÃ©cie l&rsquo;utilisation de <code>auto</code>, car cela Ã©vite d&rsquo;avoir Ã  Ã©crire des types parfois longs et de toute maniÃ¨re incomprÃ©hensibles (par exemple, <code>std::vector&lt;std::array&lt;std::string, 3&gt;&gt;</code>), et de simplifier les refactos lorsque l&rsquo;on renomme un type.<br>
Dans vos TPs, vous pouvez choisir ou non d&rsquo;utiliser <code>auto</code>, ou mÃªme de ne l&rsquo;utiliser que dans certains cas, tant que vous Ã©crivez du C++ qui est valide ðŸ™‚</p>
</div>

<h4 id="calcul-de-lopÃ©ration">Calcul de l&rsquo;opÃ©ration</h4>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div><p>Une variable appelÃ©e <code>result</code> est dÃ©finie. On suppose de par son nom qu&rsquo;elle servira Ã  stocker le rÃ©sultat de l&rsquo;opÃ©ration. Une fois de plus, <code>auto</code> est utilisÃ© et comme la variable est initialisÃ©e avec 0, on peut en dÃ©duire qu&rsquo;elle est de type <code>int</code>.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;+&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Si on doit rÃ©aliser une addition, le rÃ©sultat est obtenu en incrÃ©mentant <code>result</code> de chacune des valeurs passÃ©es au programme.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;*&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Pareil que plus haut, mais avec la multiplication. En revanche, il faut modifier la valeur initiale de <code>result</code>, car la valeur neutre pour la multiplication est 1 et pas 0. 

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Dans le cas de la soustraction, le programme attend que la premiÃ¨re valeur soit nÃ©cessairement fournie, car c&rsquo;est de cette valeur que l&rsquo;on dÃ©duit toutes les suivantes.</p>
<h4 id="affichage-du-rÃ©sultat">Affichage du rÃ©sultat</h4>
<p>Le programme termine par afficher le rÃ©sultat dans la console :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Result is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div><hr>
<h3 id="extraction-de-chaque-Ã©tape-dans-des-fonctions">Extraction de chaque Ã©tape dans des fonctions</h3>
<p>Nous allons d&rsquo;abord extraire chacune des trois Ã©tapes dans une fonction diffÃ©rente.</p>
<p>Pour l&rsquo;appel et la dÃ©finition des fonctions, vous pouvez commencer par faire comme si vous Ã©tiez en C.
Vous aurez donc pour la <strong>dÃ©finition</strong> de chaque fonction quelque chose comme :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">return_type</span> <span class="nf">fcn_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="c1">// function body ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>Pour l'<strong>appel</strong> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">fcn_name</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div><p>Et si vous prÃ©fÃ©rez dÃ©finir vos fonctions aprÃ¨s le <code>main</code>, il faudra penser Ã  les <strong>dÃ©clarer</strong> au dÃ©but du fichier cpp, juste aprÃ¨s les includes :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">return_type</span> <span class="nf">fcn1_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">return_type</span> <span class="nf">fcn2_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...);</span>
<span class="p">...</span>
</code></pre></div><h4 id="affichage-du-rÃ©sultat-1">Affichage du rÃ©sultat</h4>
<p>Nous allons commencer par l&rsquo;Ã©tape la plus simple.</p>
<p>Vous pouvez utiliser la signature suivante pour cette fonction :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">display_result</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div><p>DÃ©placez les instructions depuis le <code>main</code> vers l&rsquo;intÃ©rieur de la fonction, puis appelez la.<br>
Compilez le programme et assurez-vous qu&rsquo;il fonctionne comme avant.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Voici la fonction <code>display_result</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">display_result</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Result is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Au niveau du site de l&rsquo;appel, on peut supprimer le commentaire, qui devient redondant avec le nom de la fonction.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="calcul-de-lopÃ©ration-1">Calcul de l&rsquo;opÃ©ration</h4>
<p>Ici, la fonction ne devrait avoir besoin de renvoyer que le rÃ©sultat du calcul.
HÃ©las, Ã  l&rsquo;intÃ©rieur du traitement de la soustraction, on peut quitter prÃ©maturÃ©ment le programme si les arguments passÃ©s au programme sont invalides.
Vous allez donc commencer par dÃ©placer cette vÃ©rification dans l&rsquo;Ã©tape de traitement des arguments du programme.</p>
<p>Une fois cela fait, pensez-bien Ã  compiler et testez que le programme fonctionne toujours.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="p">...</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Vous pouvez maintenant extraire le code permettant de calculer le rÃ©sultat de l&rsquo;opÃ©ration dans une nouvelle fonction. Voici la signature attendue :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div><br/>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Pour le main, il faut bien penser Ã  passer <code>op[0]</code> Ã  la fonction, plutÃ´t que <code>op</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">compute_result</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">);</span>
    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="traitement-des-arguments-1">Traitement des arguments</h4>
<p>Cette fonction devra renvoyer trois informations :<br>
- si les arguments sont valides ou non,<br>
- l&rsquo;opÃ©rateur,<br>
- les opÃ©randes.</p>
<p>La validitÃ© des arguments sera indiquÃ©e par la valeur de retour, de type <code>bool</code>.<br>
Comme une fonction ne peut renvoyer qu&rsquo;une seule valeur, nous utiliserons les paramÃ¨tres pour rÃ©cupÃ©rer l&rsquo;opÃ©rateur et les opÃ©randes.</p>
<p>Pour l&rsquo;opÃ©rateur, vous allez rÃ©cupÃ©rer un <code>char</code> au lieu d&rsquo;une <code>string</code> complÃ¨te. En effet, dans le restant du <code>main</code>, nous attendons soit &lsquo;+&rsquo;, &lsquo;*&rsquo; ou &lsquo;-&rsquo;, donc nous n&rsquo;avons pas besoin de stocker la chaÃ®ne complÃ¨te au dÃ©jÃ  du traitement des arguments.</p>
<p>Essayez d&rsquo;utiliser la signature suivante pour votre fonction :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="n">parse_params</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</code></pre></div><p>Modifiez le code du programme et vÃ©rifiez qu&rsquo;il compile.<br>
En revanche, vous devriez constater en testant que tout ne se passe pas comme prÃ©vu&hellip;
Nous verrons comment rÃ©soudre le problÃ¨me dans la section suivante.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        
<p>Comme pour les fonctions prÃ©cÃ©dentes, vous pouvez commencer par couper-coller les instructions depuis le main vers le corps de <code>parse_params</code>.<br/>
Il faudra ensuite rÃ©aliser les changements suivants :<br/>
- remplacer les <code>return -1</code> par des <code>return false</code>, et ajouter le <code>return true</code> Ã  la fin,<br/>
- renommer <code>op</code> en <code>op_str</code>, puisqu'on introduit un paramÃ¨tre du mÃªme nom, mais de type diffÃ©rent,<br/>
- assigner <code>op_str[0]</code> Ã  <code>op</code>,<br/>
- supprimer la dÃ©finition de <code>values</code>, puisqu'on va directement remplir le tableau du mÃªme nom passÃ© en paramÃ¨tre,<br/>
- dans la derniÃ¨re condition, on peut remplacer la comparaison de chaÃ®nes (<code>op_str == "-"</code>) par une comparaison de caractÃ¨res (<code>op == '-'</code>).</p>

<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="hl"><span class="kt">bool</span> <span class="nf">parse_params</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator as first argument.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="hl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span>    <span class="p">}</span>
 
<span class="hl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">op_str</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class="hl">    <span class="k">if</span> <span class="p">(</span><span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;+&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;*&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator to be &#39;+&#39;, &#39;*&#39; or &#39;-&#39;.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="hl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span>    <span class="p">}</span>

<span class="hl">    <span class="n">op</span> <span class="o">=</span> <span class="n">op_str</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">arg_i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">arg_i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">arg_i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">arg_i</span><span class="p">]);</span>
        <span class="n">values</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hl">    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Dans le <code>main</code>, il faut remplacer le type de <code>op</code> par <code>char</code>, appeler la fonction et vÃ©rifier qu'elle renvoie bien <code>true</code> pour continuer.<br/>

<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">op</span> <span class="o">=</span> <span class="sc">&#39;?&#39;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parse_params</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">compute_result</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

    </div>
</div>
<hr>
<h3 id="les-rÃ©fÃ©rences">Les rÃ©fÃ©rences</h3>
<p>De la mÃªme maniÃ¨re qu&rsquo;en C, lorsque l&rsquo;on passe des variables Ã  une fonction, celles-ci sont copiÃ©es.<br>
Les modifications effectuÃ©es Ã  l&rsquo;intÃ©rieur de la fonction ne sont donc pas rÃ©percutÃ©es dans le code appelant.</p>
<p>En C++, il est possible de changer ce comportement trÃ¨s simplement en utilisant des <strong>rÃ©fÃ©rences</strong>.<br>
Une rÃ©fÃ©rence, c&rsquo;est simplement une variable qui agit comme un alias d&rsquo;une autre variable.
En d&rsquo;autres termes, les deux variables font rÃ©fÃ©rence au mÃªme emplacement dans la mÃ©moire.</p>
<p>Afin de dÃ©finir une rÃ©fÃ©rence, il suffit de mettre un <code>&amp;</code> derriÃ¨re le type de la variable. Par exemple :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kt">int</span><span class="o">&amp;</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
</code></pre></div><p>Et voilÃ  ! Maintenant, si vous souhaitez modifier la valeur de <code>original</code>, vous pouvez bien sÃ»r modifier <code>original</code> directement, mais vous pouvez aussi passer par <code>reference</code>. Il suffit de faire l&rsquo;assignation, de la mÃªme maniÃ¨re qu&rsquo;avec une variable classique :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">reference</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</code></pre></div><p>Et si vous modifiez <code>original</code>, la valeur de <code>reference</code> est modifiÃ©e Ã©galement.
Eh bien oui, c&rsquo;est normal, puisque les deux variables correspondent au mÃªme bloc de mÃ©moire.
Vous pouvez d&rsquo;ailleurs essayer d&rsquo;imprimer leurs adresses pour en Ãªtre convaincus :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">&amp;</span><span class="n">original</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="o">&amp;</span><span class="n">reference</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<div class="notices tip" ><p>D&rsquo;ailleurs, pour avoir l&rsquo;adresse d&rsquo;une variable, il faut aussi utiliser le caractÃ¨re <code>&amp;</code>. C&rsquo;est un peu confusant tout Ã§a&hellip;<br>
HÃ©las, en C++, on rÃ©utilise en permanence les mÃªmes symboles et les mÃªmes mots-clefs pour faire des choses diffÃ©rentes, ce qui est un peu dommage, mais Ã§a permet d&rsquo;assurer la rÃ©tro-compatibilitÃ© du langage.<br>
Pour savoir si on parle d&rsquo;une rÃ©fÃ©rence ou d&rsquo;une adresse, il suffit de regarder oÃ¹ est placÃ© le <code>&amp;</code>. Si c&rsquo;est derriÃ¨re le type d&rsquo;une variable, c&rsquo;est une rÃ©fÃ©rence. Si ce n&rsquo;est pas derriÃ¨re le type d&rsquo;une variable, c&rsquo;est probablement une adresse, ou alors une erreur de syntaxe&hellip;<br>
De toute maniÃ¨re, on ne peut parler de rÃ©fÃ©rence qu&rsquo;Ã  la dÃ©finition d&rsquo;une variable, puisqu&rsquo;ensuite, on la manipule exactement de la mÃªme maniÃ¨re que n&rsquo;importe quelle autre variable.</p>
</div>

<h4 id="passage-par-rÃ©fÃ©rence">Passage par rÃ©fÃ©rence</h4>
<p>Nous allons maintenant utiliser les rÃ©fÃ©rences pour rÃ©soudre le bug introduit avec l&rsquo;ajout de la fonction <code>parse_params</code>.</p>
<p>Ajoutez un <code>&amp;</code> sur le type de <code>op</code> dans la signature de <code>parse_params</code>.
Faites de mÃªme avec <code>values</code>.<br>
Testez que le programme fonctionne Ã  nouveau correctement.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">parse_params</span><span class="p">(</span><span class="kt">char</span><span class="o">&amp;</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="passage-par-rÃ©fÃ©rence-constante">Passage par rÃ©fÃ©rence constante</h4>
<p>Un autre cas d&rsquo;utilisation des rÃ©fÃ©rences, c&rsquo;est pour passer des paramÃ¨tres coÃ»teux Ã  copier Ã  une fonction.<br>
Par exemple, pour passer des classes qui rÃ©alisent des allocations dynamiques en interne, comme std::vector ou std::string, on peut tout Ã  fait dÃ©cider d&rsquo;utiliser des rÃ©fÃ©rences pour Ã©viter de rÃ©allouer de la mÃ©moire pour rien.</p>
<p>Le problÃ¨me de passer d&rsquo;une copie Ã  une rÃ©fÃ©rence, c&rsquo;est que l&rsquo;on donne le pouvoir Ã  la fonction de modifier des choses qu&rsquo;on souhaiterait qu&rsquo;elle ne modifie pas. Pour Ã©viter cela, on va passer les paramÃ¨tres en utilisant des <strong>rÃ©fÃ©rences constantes</strong> (abbrÃ©gÃ© const-ref). Pour dÃ©finir une const-ref, il suffit de placer le mot-clef <code>const</code> Ã -cÃ´tÃ© du type de la variable :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">const_ref</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
</code></pre></div><p>Avec le code ci-dessus, vous pourrez lire le contenu de <code>const_ref</code>, mais vous ne pourrez pas le modifier. Si vous essayez d&rsquo;Ã©crire <code>const_ref = 8</code>, vous aurez une erreur de compilation.</p>
<p>Modifiez la signature de <code>compute_result</code> de maniÃ¨re Ã  passer le tableau <code>values</code> par const-ref plutÃ´t que par valeur.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="switch-">Switch !</h3>
<p>Le code de la calculette est maintenant un peu plus structurÃ©. Vous allez maintenant remplacer les <code>if / else</code> dans la fonction <code>compute_result</code> par un <code>switch</code>. Le <code>switch</code> en C++, c&rsquo;est exactement le mÃªme que celui du C. N&rsquo;oubliez pas les <code>break</code> Ã  la fin de chaque <code>case</code>.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span>
<span class="p">{</span>
<span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="sc">&#39;*&#39;</span><span class="o">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
<span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">default</span><span class="o">:</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="notices note" ><p>Vous vous demandez pourquoi j&rsquo;ai ajoutÃ© la clause par dÃ©faut alors que tous les cas ont Ã©tÃ© traitÃ©s ?<br>
En fait, le compilateur n&rsquo;est pas suffisamment malin pour se rendre compte que <code>op</code> ne peut pas prendre d&rsquo;autres valeurs que celles indiquÃ©es. On ajoute donc la clause <code>default</code>, car sinon, on se retrouve avec des warnings. Et les warnings, c&rsquo;est le dÃ©but des erreurs.<br>
Si on voulait aller plus loin, on pourrait utiliser un <code>enum class</code> Ã  la place d&rsquo;un <code>char</code> pour indiquer au compilateur la liste exhaustive des valeurs Ã  traiter.</p>
</div>

    </div>
</div>
<p>Mmmmh, le rÃ©sultat n&rsquo;est pas forcÃ©ment trÃ¨s lisible. En gÃ©nÃ©ral, on Ã©vite de mettre trop de code dans les <code>cases</code>, surtout quand il s&rsquo;agit de boucles ou de conditions.<br>
Pour corriger Ã§a, ajoutez des fonctions <code>add</code>, <code>multiply</code> et <code>sub</code>, et appelez-les depuis votre switch.<br>
Pensez-bien Ã  Ã©viter les copies inutiles de <code>vector</code>.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">sub</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>

    <span class="k">case</span> <span class="sc">&#39;*&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>
            
    <span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">sub</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>

    <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/CPP_Learning/chapter1/2-practice/3-array/" title="ðŸ”¢ Tableau NumÃ©rique"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/CPP_Learning/chapter1/test/" title="Questionnaire !" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/CPP_Learning/js/clipboard.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.jquery.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/jquery.sticky.js?1641495014"></script>
    <script src="/CPP_Learning/js/featherlight.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/highlight.pack.js?1641495014"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/CPP_Learning/js/modernizr.custom-3.6.0.js?1641495014"></script>
    <script src="/CPP_Learning/js/learn.js?1641495014"></script>
    <script src="/CPP_Learning/js/hugo-learn.js?1641495014"></script>

    <link href="/CPP_Learning/mermaid/mermaid.css?1641495014" rel="stylesheet" />
    <script src="/CPP_Learning/mermaid/mermaid.js?1641495014"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

