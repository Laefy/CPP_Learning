<!DOCTYPE html>
<html lang="fr" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="">


    <link rel="icon" href="/CPP_Learning/images/favicon.png" type="image/png">

    <title>üßÆ Calculette :: Cours de C&#43;&#43; - Niveau Master</title>

    
    <link href="/CPP_Learning/css/nucleus.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/fontawesome-all.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/hybrid.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/featherlight.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/perfect-scrollbar.min.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/auto-complete.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/atom-one-dark-reasonable.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/theme.css?1641495013" rel="stylesheet">
    <link href="/CPP_Learning/css/hugo-theme.css?1641495013" rel="stylesheet">
    
    <link href="/CPP_Learning/css/theme-mine.css?1641495013" rel="stylesheet">
    
    <link href="/CPP_Learning/css/syntax.css?1641495013" rel="stylesheet">

    <script src="/CPP_Learning/js/jquery-3.3.1.min.js?1641495013"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/CPP_Learning/chapter1/2-practice/4-calculator/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://laefy.github.io/CPP_Learning/">üéÑ C++ üéÑ</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Rechercher...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/CPP_Learning/js/lunr.min.js?1641495013"></script>
<script type="text/javascript" src="/CPP_Learning/js/auto-complete.js?1641495013"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/laefy.github.io\/CPP_Learning\/";
    
</script>
<script type="text/javascript" src="/CPP_Learning/js/search.js?1641495013"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter0/" title="Mise en place" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter0/">
          <b>0- </b>Mise en place
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/1-compiler/" title="Compilateur" class="dd-item ">
        <a href="/CPP_Learning/chapter0/1-compiler/">
        Compilateur
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/2-vscode/" title="Visual Studio Code" class="dd-item ">
        <a href="/CPP_Learning/chapter0/2-vscode/">
        Visual Studio Code
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/3-cmake/" title="CMake" class="dd-item ">
        <a href="/CPP_Learning/chapter0/3-cmake/">
        CMake
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/4-git/" title="Git" class="dd-item ">
        <a href="/CPP_Learning/chapter0/4-git/">
        Git
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/5-clang-format/" title="Clang-Format" class="dd-item ">
        <a href="/CPP_Learning/chapter0/5-clang-format/">
        Clang-Format
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/6-tips/" title="Astuces" class="dd-item ">
        <a href="/CPP_Learning/chapter0/6-tips/">
        Astuces
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter0/test/" title="Retours ?" class="dd-item ">
        <a href="/CPP_Learning/chapter0/test/">
        Retours ?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/" title="Introduction au C&#43;&#43;" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter1/">
          <b>1- </b>Introduction au C&#43;&#43;
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/1-language/" title="Pr√©sentation du langage" class="dd-item ">
        <a href="/CPP_Learning/chapter1/1-language/">
        Pr√©sentation du langage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/2-practice/" title="Premiers programmes" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter1/2-practice/">
          Premiers programmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/1-hello-world/" title="üëã Hello World" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/1-hello-world/">
        üëã Hello World
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/2-parrot/" title="ü¶ú Perroquet" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/2-parrot/">
        ü¶ú Perroquet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/3-array/" title="üî¢ Tableau Num√©rique" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-practice/3-array/">
        üî¢ Tableau Num√©rique
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-practice/4-calculator/" title="üßÆ Calculette" class="dd-item active">
        <a href="/CPP_Learning/chapter1/2-practice/4-calculator/">
        üßÆ Calculette
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter1/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter1/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>Acc√®s rapide</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/Laefy/CPP_Learning_Code/"><i class='fab fa-github'></i> D√©p√¥t GitHub</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/workflow"><i class='far fa-list-alt'></i> Workflow</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/faq"><i class='fas fa-question-circle'></i> FAQ</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/chapter0/6-tips/"><i class='fa fa-rocket'></i> Astuces</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://en.cppreference.com/w/"><i class='fas fa-passport'></i> CPP-Ref</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Supprimer l&#39;historique</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/CPP_Learning/'>Accueil</a> > <a href='/CPP_Learning/chapter1/'>Introduction au C++</a> > <a href='/CPP_Learning/chapter1/2-practice/'>Premiers programmes</a> > üßÆ Calculette
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#comprendre-le-code-existant">Comprendre le code existant</a></li>
        <li><a href="#extraction-de-chaque-√©tape-dans-des-fonctions">Extraction de chaque √©tape dans des fonctions</a></li>
        <li><a href="#les-r√©f√©rences">Les r√©f√©rences</a></li>
        <li><a href="#switch-">Switch !</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              üßÆ Calculette
            </h1>
          

        


<p>Dans cet exercice, vous refactoriserez le code d&rsquo;une mini-calculette. Cela sera l&rsquo;occasion de voir l&rsquo;instruction switch, les fonctions et le passage de param√®tres par r√©f√©rence.</p>
<hr>
<p>Pour cet exercice, vous modifierez le fichier :<br>
- <code>chap-01/4-calculator.cpp</code></p>
<p>La cible √† compiler est <code>c1-4-calculator</code>.</p>
<hr>
<h3 id="comprendre-le-code-existant">Comprendre le code existant</h3>
<p>Commen√ßons par parcourir le code fourni, afin de comprendre ce qu&rsquo;il s&rsquo;y passe.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Output result.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>D√©j√†, en regardant les commentaires, on se rend compte que le programme comporte 3 √©tapes :</p>
<ol>
<li>Traitement des arguments</li>
<li>Calcul de l&rsquo;op√©ration</li>
<li>Affichage du r√©sultat</li>
</ol>
<p>Nous allons analyser le code de chacune de ces √©tapes.</p>
<h4 id="traitement-des-arguments">Traitement des arguments</h4>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator as first argument.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Ce premier <code>if</code> est plut√¥t simple √† comprendre. Le programme attend pour premier argument un op√©rateur, donc si on a moins d&rsquo;un argument (2 car <code>argv[0]</code> est le nom de la commande), on s&rsquo;arr√™te.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">op</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</code></pre></div><p>L&rsquo;expression <code>argv[1]</code>, c&rsquo;est-√†-dire ce que l&rsquo;on s&rsquo;attend √† √™tre l&rsquo;op√©rateur, est plac√©e dans une <code>std::string</code>. Ecrire cette instruction a deux avantages :<br>
- d√©j√†, cela permet d&rsquo;avoir un nom de variable un peu plus explicite que &lsquo;argv[1]&rsquo;, et donc de rendre le code plus clair,<br>
- ensuite, on se retrouve avec une variable de type <code>std::string</code> plut√¥t que <code>char*</code>. Or, si on fait <code>==</code> entre deux <code>std::string</code>, on compare bien les cha√Ænes de caract√®res, alors que si on fait <code>==</code> entre deux <code>char*</code>, on compare en fait deux adresses en m√©moire (<code>char*</code> n&rsquo;√©tant qu&rsquo;un pointeur).

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;+&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;*&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op</span> <span class="o">!=</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator to be &#39;+&#39;, &#39;*&#39; or &#39;-&#39;.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Le programme ne supportant que les additions, multiplications ou soustractions, on s&rsquo;arr√™te si l&rsquo;op√©rateur ne correspond pas √† l&rsquo;une de ces trois op√©rations.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">arg_i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">arg_i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">arg_i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">arg_i</span><span class="p">]);</span>
    <span class="n">values</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> 
<span class="p">}</span>
</code></pre></div><p>Un tableau de valeurs est d√©fini, et il est rempli avec les arguments donn√©s au programme √† la suite de l&rsquo;op√©rateur. <code>std::stoi</code> est utilis√©e pour convertir les cha√Ænes en entiers.<br>
La seule chose un peu √©tonnante ici, c&rsquo;est l&rsquo;utilisation de <code>auto</code> √† la place de <code>int</code>. En fait, <code>auto</code> permet de ne pas avoir √† sp√©cifier en permanence les types que l&rsquo;on manipule lorsque le compilateur peut les d√©duire par lui-m√™me. Ici, en √©crivant <code>auto arg_i = 2</code>, le compilateur est capable de d√©terminer que <code>arg_i</code> est de type <code>int</code>, puisqu&rsquo;on l&rsquo;initialise avec 2. Dans la ligne suivante, le compilateur est √©galement capable de d√©duire tout seul que <code>value</code> sera de type <code>int</code>, car la fonction <code>stoi</code> retourne un r√©sultat de type <code>int</code>.</p>

<div class="notices note" ><p>Certaines personnes n&rsquo;aiment pas utiliser <code>auto</code>, car elles trouvent que cela rend le code moins clair. C&rsquo;est effectivement l&rsquo;un des inconv√©nients, surtout si l&rsquo;on n&rsquo;utilise pas d&rsquo;IDE. Si on utilise un IDE, ce probl√®me est quasiment inexistant, puisqu&rsquo;il suffit g√©n√©ralement de passer son curseur au-dessus du nom de la variable pour obtenir le vrai type.<br>
Personnellement, j&rsquo;appr√©cie l&rsquo;utilisation de <code>auto</code>, car cela √©vite d&rsquo;avoir √† √©crire des types parfois longs et de toute mani√®re incompr√©hensibles (par exemple, <code>std::vector&lt;std::array&lt;std::string, 3&gt;&gt;</code>), et de simplifier les refactos lorsque l&rsquo;on renomme un type.<br>
Dans vos TPs, vous pouvez choisir ou non d&rsquo;utiliser <code>auto</code>, ou m√™me de ne l&rsquo;utiliser que dans certains cas, tant que vous √©crivez du C++ qui est valide üôÇ</p>
</div>

<h4 id="calcul-de-lop√©ration">Calcul de l&rsquo;op√©ration</h4>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div><p>Une variable appel√©e <code>result</code> est d√©finie. On suppose de par son nom qu&rsquo;elle servira √† stocker le r√©sultat de l&rsquo;op√©ration. Une fois de plus, <code>auto</code> est utilis√© et comme la variable est initialis√©e avec 0, on peut en d√©duire qu&rsquo;elle est de type <code>int</code>.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;+&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Si on doit r√©aliser une addition, le r√©sultat est obtenu en incr√©mentant <code>result</code> de chacune des valeurs pass√©es au programme.

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;*&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Pareil que plus haut, mais avec la multiplication. En revanche, il faut modifier la valeur initiale de <code>result</code>, car la valeur neutre pour la multiplication est 1 et pas 0. 

<br/><br/></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Dans le cas de la soustraction, le programme attend que la premi√®re valeur soit n√©cessairement fournie, car c&rsquo;est de cette valeur que l&rsquo;on d√©duit toutes les suivantes.</p>
<h4 id="affichage-du-r√©sultat">Affichage du r√©sultat</h4>
<p>Le programme termine par afficher le r√©sultat dans la console :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Result is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div><hr>
<h3 id="extraction-de-chaque-√©tape-dans-des-fonctions">Extraction de chaque √©tape dans des fonctions</h3>
<p>Nous allons d&rsquo;abord extraire chacune des trois √©tapes dans une fonction diff√©rente.</p>
<p>Pour l&rsquo;appel et la d√©finition des fonctions, vous pouvez commencer par faire comme si vous √©tiez en C.
Vous aurez donc pour la <strong>d√©finition</strong> de chaque fonction quelque chose comme :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">return_type</span> <span class="nf">fcn_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
    <span class="c1">// function body ...
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><p>Pour l'<strong>appel</strong> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">fcn_name</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="p">...);</span>
</code></pre></div><p>Et si vous pr√©f√©rez d√©finir vos fonctions apr√®s le <code>main</code>, il faudra penser √† les <strong>d√©clarer</strong> au d√©but du fichier cpp, juste apr√®s les includes :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">return_type</span> <span class="nf">fcn1_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">return_type</span> <span class="nf">fcn2_name</span><span class="p">(</span><span class="n">p1_type</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2_type</span> <span class="n">p2</span><span class="p">,</span> <span class="p">...);</span>
<span class="p">...</span>
</code></pre></div><h4 id="affichage-du-r√©sultat-1">Affichage du r√©sultat</h4>
<p>Nous allons commencer par l&rsquo;√©tape la plus simple.</p>
<p>Vous pouvez utiliser la signature suivante pour cette fonction :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="n">display_result</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div><p>D√©placez les instructions depuis le <code>main</code> vers l&rsquo;int√©rieur de la fonction, puis appelez la.<br>
Compilez le programme et assurez-vous qu&rsquo;il fonctionne comme avant.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Voici la fonction <code>display_result</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">display_result</span><span class="p">(</span><span class="kt">int</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Result is &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Au niveau du site de l&rsquo;appel, on peut supprimer le commentaire, qui devient redondant avec le nom de la fonction.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="n">some</span> <span class="n">code</span><span class="p">...</span>

    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="calcul-de-lop√©ration-1">Calcul de l&rsquo;op√©ration</h4>
<p>Ici, la fonction ne devrait avoir besoin de renvoyer que le r√©sultat du calcul.
H√©las, √† l&rsquo;int√©rieur du traitement de la soustraction, on peut quitter pr√©matur√©ment le programme si les arguments pass√©s au programme sont invalides.
Vous allez donc commencer par d√©placer cette v√©rification dans l&rsquo;√©tape de traitement des arguments du programme.</p>
<p>Une fois cela fait, pensez-bien √† compiler et testez que le programme fonctionne toujours.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Process operation, depending on the operator.
</span><span class="c1"></span>    <span class="p">...</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Vous pouvez maintenant extraire le code permettant de calculer le r√©sultat de l&rsquo;op√©ration dans une nouvelle fonction. Voici la signature attendue :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div><br/>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;+&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;*&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Pour le main, il faut bien penser √† passer <code>op[0]</code> √† la fonction, plut√¥t que <code>op</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Parsing program parameters.
</span><span class="c1"></span>    <span class="p">...</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">compute_result</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">);</span>
    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="traitement-des-arguments-1">Traitement des arguments</h4>
<p>Cette fonction devra renvoyer trois informations :<br>
- si les arguments sont valides ou non,<br>
- l&rsquo;op√©rateur,<br>
- les op√©randes.</p>
<p>La validit√© des arguments sera indiqu√©e par la valeur de retour, de type <code>bool</code>.<br>
Comme une fonction ne peut renvoyer qu&rsquo;une seule valeur, nous utiliserons les param√®tres pour r√©cup√©rer l&rsquo;op√©rateur et les op√©randes.</p>
<p>Pour l&rsquo;op√©rateur, vous allez r√©cup√©rer un <code>char</code> au lieu d&rsquo;une <code>string</code> compl√®te. En effet, dans le restant du <code>main</code>, nous attendons soit &lsquo;+&rsquo;, &lsquo;*&rsquo; ou &lsquo;-&rsquo;, donc nous n&rsquo;avons pas besoin de stocker la cha√Æne compl√®te au d√©j√† du traitement des arguments.</p>
<p>Essayez d&rsquo;utiliser la signature suivante pour votre fonction :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="n">parse_params</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</code></pre></div><p>Modifiez le code du programme et v√©rifiez qu&rsquo;il compile.<br>
En revanche, vous devriez constater en testant que tout ne se passe pas comme pr√©vu&hellip;
Nous verrons comment r√©soudre le probl√®me dans la section suivante.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        
<p>Comme pour les fonctions pr√©c√©dentes, vous pouvez commencer par couper-coller les instructions depuis le main vers le corps de <code>parse_params</code>.<br/>
Il faudra ensuite r√©aliser les changements suivants :<br/>
- remplacer les <code>return -1</code> par des <code>return false</code>, et ajouter le <code>return true</code> √† la fin,<br/>
- renommer <code>op</code> en <code>op_str</code>, puisqu'on introduit un param√®tre du m√™me nom, mais de type diff√©rent,<br/>
- assigner <code>op_str[0]</code> √† <code>op</code>,<br/>
- supprimer la d√©finition de <code>values</code>, puisqu'on va directement remplir le tableau du m√™me nom pass√© en param√®tre,<br/>
- dans la derni√®re condition, on peut remplacer la comparaison de cha√Ænes (<code>op_str == "-"</code>) par une comparaison de caract√®res (<code>op == '-'</code>).</p>

<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="hl"><span class="kt">bool</span> <span class="nf">parse_params</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span><span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator as first argument.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="hl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span>    <span class="p">}</span>
 
<span class="hl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">op_str</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class="hl">    <span class="k">if</span> <span class="p">(</span><span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;+&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;*&#34;</span> <span class="o">&amp;&amp;</span> <span class="n">op_str</span> <span class="o">!=</span> <span class="s">&#34;-&#34;</span><span class="p">)</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Expected operator to be &#39;+&#39;, &#39;*&#39; or &#39;-&#39;.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="hl">        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span>    <span class="p">}</span>

<span class="hl">    <span class="n">op</span> <span class="o">=</span> <span class="n">op_str</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">arg_i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">arg_i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="o">++</span><span class="n">arg_i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">value</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">arg_i</span><span class="p">]);</span>
        <span class="n">values</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hl">    <span class="k">if</span> <span class="p">(</span><span class="n">op</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span>    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Operator &#39;-&#39; expects at least one operand to substract from.&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Dans le <code>main</code>, il faut remplacer le type de <code>op</code> par <code>char</code>, appeler la fonction et v√©rifier qu'elle renvoie bien <code>true</code> pour continuer.<br/>

<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">op</span> <span class="o">=</span> <span class="sc">&#39;?&#39;</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parse_params</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">compute_result</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">values</span><span class="p">);</span>
    <span class="n">display_result</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

    </div>
</div>
<hr>
<h3 id="les-r√©f√©rences">Les r√©f√©rences</h3>
<p>De la m√™me mani√®re qu&rsquo;en C, lorsque l&rsquo;on passe des variables √† une fonction, celles-ci sont copi√©es.<br>
Les modifications effectu√©es √† l&rsquo;int√©rieur de la fonction ne sont donc pas r√©percut√©es dans le code appelant.</p>
<p>En C++, il est possible de changer ce comportement tr√®s simplement en utilisant des <strong>r√©f√©rences</strong>.<br>
Une r√©f√©rence, c&rsquo;est simplement une variable qui agit comme un alias d&rsquo;une autre variable.
En d&rsquo;autres termes, les deux variables font r√©f√©rence au m√™me emplacement dans la m√©moire.</p>
<p>Afin de d√©finir une r√©f√©rence, il suffit de mettre un <code>&amp;</code> derri√®re le type de la variable. Par exemple :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="kt">int</span><span class="o">&amp;</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
</code></pre></div><p>Et voil√† ! Maintenant, si vous souhaitez modifier la valeur de <code>original</code>, vous pouvez bien s√ªr modifier <code>original</code> directement, mais vous pouvez aussi passer par <code>reference</code>. Il suffit de faire l&rsquo;assignation, de la m√™me mani√®re qu&rsquo;avec une variable classique :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">reference</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</code></pre></div><p>Et si vous modifiez <code>original</code>, la valeur de <code>reference</code> est modifi√©e √©galement.
Eh bien oui, c&rsquo;est normal, puisque les deux variables correspondent au m√™me bloc de m√©moire.
Vous pouvez d&rsquo;ailleurs essayer d&rsquo;imprimer leurs adresses pour en √™tre convaincus :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">&amp;</span><span class="n">original</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="o">&amp;</span><span class="n">reference</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre></div>
<div class="notices tip" ><p>D&rsquo;ailleurs, pour avoir l&rsquo;adresse d&rsquo;une variable, il faut aussi utiliser le caract√®re <code>&amp;</code>. C&rsquo;est un peu confusant tout √ßa&hellip;<br>
H√©las, en C++, on r√©utilise en permanence les m√™mes symboles et les m√™mes mots-clefs pour faire des choses diff√©rentes, ce qui est un peu dommage, mais √ßa permet d&rsquo;assurer la r√©tro-compatibilit√© du langage.<br>
Pour savoir si on parle d&rsquo;une r√©f√©rence ou d&rsquo;une adresse, il suffit de regarder o√π est plac√© le <code>&amp;</code>. Si c&rsquo;est derri√®re le type d&rsquo;une variable, c&rsquo;est une r√©f√©rence. Si ce n&rsquo;est pas derri√®re le type d&rsquo;une variable, c&rsquo;est probablement une adresse, ou alors une erreur de syntaxe&hellip;<br>
De toute mani√®re, on ne peut parler de r√©f√©rence qu&rsquo;√† la d√©finition d&rsquo;une variable, puisqu&rsquo;ensuite, on la manipule exactement de la m√™me mani√®re que n&rsquo;importe quelle autre variable.</p>
</div>

<h4 id="passage-par-r√©f√©rence">Passage par r√©f√©rence</h4>
<p>Nous allons maintenant utiliser les r√©f√©rences pour r√©soudre le bug introduit avec l&rsquo;ajout de la fonction <code>parse_params</code>.</p>
<p>Ajoutez un <code>&amp;</code> sur le type de <code>op</code> dans la signature de <code>parse_params</code>.
Faites de m√™me avec <code>values</code>.<br>
Testez que le programme fonctionne √† nouveau correctement.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">parse_params</span><span class="p">(</span><span class="kt">char</span><span class="o">&amp;</span> <span class="n">op</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">,</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<h4 id="passage-par-r√©f√©rence-constante">Passage par r√©f√©rence constante</h4>
<p>Un autre cas d&rsquo;utilisation des r√©f√©rences, c&rsquo;est pour passer des param√®tres co√ªteux √† copier √† une fonction.<br>
Par exemple, pour passer des classes qui r√©alisent des allocations dynamiques en interne, comme std::vector ou std::string, on peut tout √† fait d√©cider d&rsquo;utiliser des r√©f√©rences pour √©viter de r√©allouer de la m√©moire pour rien.</p>
<p>Le probl√®me de passer d&rsquo;une copie √† une r√©f√©rence, c&rsquo;est que l&rsquo;on donne le pouvoir √† la fonction de modifier des choses qu&rsquo;on souhaiterait qu&rsquo;elle ne modifie pas. Pour √©viter cela, on va passer les param√®tres en utilisant des <strong>r√©f√©rences constantes</strong> (abbr√©g√© const-ref). Pour d√©finir une const-ref, il suffit de placer le mot-clef <code>const</code> √†-c√¥t√© du type de la variable :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">const_ref</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
</code></pre></div><p>Avec le code ci-dessus, vous pourrez lire le contenu de <code>const_ref</code>, mais vous ne pourrez pas le modifier. Si vous essayez d&rsquo;√©crire <code>const_ref = 8</code>, vous aurez une erreur de compilation.</p>
<p>Modifiez la signature de <code>compute_result</code> de mani√®re √† passer le tableau <code>values</code> par const-ref plut√¥t que par valeur.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="switch-">Switch !</h3>
<p>Le code de la calculette est maintenant un peu plus structur√©. Vous allez maintenant remplacer les <code>if / else</code> dans la fonction <code>compute_result</code> par un <code>switch</code>. Le <code>switch</code> en C++, c&rsquo;est exactement le m√™me que celui du C. N&rsquo;oubliez pas les <code>break</code> √† la fin de chaque <code>case</code>.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span>
<span class="p">{</span>
<span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="sc">&#39;*&#39;</span><span class="o">:</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
    
<span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">default</span><span class="o">:</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="notices note" ><p>Vous vous demandez pourquoi j&rsquo;ai ajout√© la clause par d√©faut alors que tous les cas ont √©t√© trait√©s ?<br>
En fait, le compilateur n&rsquo;est pas suffisamment malin pour se rendre compte que <code>op</code> ne peut pas prendre d&rsquo;autres valeurs que celles indiqu√©es. On ajoute donc la clause <code>default</code>, car sinon, on se retrouve avec des warnings. Et les warnings, c&rsquo;est le d√©but des erreurs.<br>
Si on voulait aller plus loin, on pourrait utiliser un <code>enum class</code> √† la place d&rsquo;un <code>char</code> pour indiquer au compilateur la liste exhaustive des valeurs √† traiter.</p>
</div>

    </div>
</div>
<p>Mmmmh, le r√©sultat n&rsquo;est pas forc√©ment tr√®s lisible. En g√©n√©ral, on √©vite de mettre trop de code dans les <code>cases</code>, surtout quand il s&rsquo;agit de boucles ou de conditions.<br>
Pour corriger √ßa, ajoutez des fonctions <code>add</code>, <code>multiply</code> et <code>sub</code>, et appelez-les depuis votre switch.<br>
Pensez-bien √† √©viter les copies inutiles de <code>vector</code>.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">multiply</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">v</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">sub</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">-=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">compute_result</span><span class="p">(</span><span class="kt">char</span> <span class="n">op</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="sc">&#39;+&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">add</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>

    <span class="k">case</span> <span class="sc">&#39;*&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">multiply</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>
            
    <span class="k">case</span> <span class="sc">&#39;-&#39;</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">sub</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>

    <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/CPP_Learning/chapter1/2-practice/3-array/" title="üî¢ Tableau Num√©rique"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/CPP_Learning/chapter1/test/" title="Questionnaire !" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/CPP_Learning/js/clipboard.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.jquery.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/jquery.sticky.js?1641495014"></script>
    <script src="/CPP_Learning/js/featherlight.min.js?1641495014"></script>
    <script src="/CPP_Learning/js/highlight.pack.js?1641495014"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/CPP_Learning/js/modernizr.custom-3.6.0.js?1641495014"></script>
    <script src="/CPP_Learning/js/learn.js?1641495014"></script>
    <script src="/CPP_Learning/js/hugo-learn.js?1641495014"></script>

    <link href="/CPP_Learning/mermaid/mermaid.css?1641495014" rel="stylesheet" />
    <script src="/CPP_Learning/mermaid/mermaid.js?1641495014"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

