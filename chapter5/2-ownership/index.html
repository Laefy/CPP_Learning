<!DOCTYPE html>
<html lang="fr" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="">


    <link rel="icon" href="/CPP_Learning/images/favicon.png" type="image/png">

    <title>Ownership :: Cours de C&#43;&#43; - Niveau Master</title>

    
    <link href="/CPP_Learning/css/nucleus.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/fontawesome-all.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/hybrid.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/featherlight.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/perfect-scrollbar.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/auto-complete.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/atom-one-dark-reasonable.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/theme.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/hugo-theme.css?1616215070" rel="stylesheet">
    
    <link href="/CPP_Learning/css/theme-mine.css?1616215070" rel="stylesheet">
    
    <link href="/CPP_Learning/css/syntax.css?1616215070" rel="stylesheet">

    <script src="/CPP_Learning/js/jquery-3.3.1.min.js?1616215070"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/CPP_Learning/chapter5/2-ownership/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://laefy.github.io/CPP_Learning/">ü•û C++ ü•û</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Rechercher...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/CPP_Learning/js/lunr.min.js?1616215070"></script>
<script type="text/javascript" src="/CPP_Learning/js/auto-complete.js?1616215070"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/laefy.github.io\/CPP_Learning\/";
    
</script>
<script type="text/javascript" src="/CPP_Learning/js/search.js?1616215070"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/" title="Introduction au C&#43;&#43;" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/">
          <b>1- </b>Introduction au C&#43;&#43;
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/1-language/" title="Pr√©sentation du langage" class="dd-item ">
        <a href="/CPP_Learning/chapter1/1-language/">
        Pr√©sentation du langage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/2-tools/" title="Outils" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/2-tools/">
          Outils
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/1-vscode/" title="Visual Studio Code" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/1-vscode/">
        Visual Studio Code
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/2-cmake/" title="CMake" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/2-cmake/">
        CMake
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/3-git/" title="Git" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/3-git/">
        Git
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/4-compilation/" title="Compilation &amp; Ex√©cution" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/4-compilation/">
        Compilation &amp; Ex√©cution
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/3-practice/" title="Premiers programmes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/3-practice/">
          Premiers programmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/1-hello-world/" title="üëã Hello World" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/1-hello-world/">
        üëã Hello World
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/2-parrot.fd/" title="ü¶ú Perroquet" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/2-parrot.fd/">
        ü¶ú Perroquet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/3-array/" title="üî¢ Tableau Num√©rique" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/3-array/">
        üî¢ Tableau Num√©rique
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/4-calculator/" title="üßÆ Calculette" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/4-calculator/">
        üßÆ Calculette
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter1/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter1/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter2/" title="Classes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter2/">
          <b>2- </b>Classes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/1-poo/" title="C&#39;est quoi un objet d√©j√† ?" class="dd-item ">
        <a href="/CPP_Learning/chapter2/1-poo/">
        C&#39;est quoi un objet d√©j√† ?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/2-first-class/" title="‚ú® Premi√®re classe" class="dd-item ">
        <a href="/CPP_Learning/chapter2/2-first-class/">
        ‚ú® Premi√®re classe
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/3-constructor/" title="üî® Constructeur" class="dd-item ">
        <a href="/CPP_Learning/chapter2/3-constructor/">
        üî® Constructeur
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/4-clone/" title="üß¨ Cl√¥ne" class="dd-item ">
        <a href="/CPP_Learning/chapter2/4-clone/">
        üß¨ Cl√¥ne
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/5-rectangle/" title="üî≥ Rectangle" class="dd-item ">
        <a href="/CPP_Learning/chapter2/5-rectangle/">
        üî≥ Rectangle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/6-polygon/" title="üí† Polyg√¥ne" class="dd-item ">
        <a href="/CPP_Learning/chapter2/6-polygon/">
        üí† Polyg√¥ne
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter2/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter2/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter3/" title="Conteneurs standards" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter3/">
          <b>3- </b>Conteneurs standards
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/1-doc/" title="Un peu de doc..." class="dd-item ">
        <a href="/CPP_Learning/chapter3/1-doc/">
        Un peu de doc...
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/2-vectors/" title="Tableaux dynamiques" class="dd-item ">
        <a href="/CPP_Learning/chapter3/2-vectors/">
        Tableaux dynamiques
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/3-sequentials/" title="Autres conteneurs s√©quentiels" class="dd-item ">
        <a href="/CPP_Learning/chapter3/3-sequentials/">
        Autres conteneurs s√©quentiels
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/4-associatives/" title="Conteneurs associatifs" class="dd-item ">
        <a href="/CPP_Learning/chapter3/4-associatives/">
        Conteneurs associatifs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/5-strings/" title="Manipulation de cha√Ænes" class="dd-item ">
        <a href="/CPP_Learning/chapter3/5-strings/">
        Manipulation de cha√Ænes
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/6-tuples/" title="Paires et tuples" class="dd-item ">
        <a href="/CPP_Learning/chapter3/6-tuples/">
        Paires et tuples
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter3/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter3/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter4/" title="H√©ritage" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter4/">
          <b>4- </b>H√©ritage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/1-hierarchy/" title="üíº Hi√©rarchie professionnelle" class="dd-item ">
        <a href="/CPP_Learning/chapter4/1-hierarchy/">
        üíº Hi√©rarchie professionnelle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/2-farm/" title="üêÆ Concerto animalier" class="dd-item ">
        <a href="/CPP_Learning/chapter4/2-farm/">
        üêÆ Concerto animalier
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/3-virtual/" title="R√©solution d&#39;appel virtuel" class="dd-item ">
        <a href="/CPP_Learning/chapter4/3-virtual/">
        R√©solution d&#39;appel virtuel
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/4-polymorphism/" title="Polymorphisme" class="dd-item ">
        <a href="/CPP_Learning/chapter4/4-polymorphism/">
        Polymorphisme
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/5-vehicles/" title="üöó V√©hicule partag√©" class="dd-item ">
        <a href="/CPP_Learning/chapter4/5-vehicles/">
        üöó V√©hicule partag√©
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter4/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter4/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter5/" title="Gestion des ressources" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter5/">
          <b>5- </b>Gestion des ressources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/1-lifespan/" title="Dur√©e de vie" class="dd-item ">
        <a href="/CPP_Learning/chapter5/1-lifespan/">
        Dur√©e de vie
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/2-ownership/" title="Ownership" class="dd-item active">
        <a href="/CPP_Learning/chapter5/2-ownership/">
        Ownership
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/3-smart-ptrs/" title="Pointeurs intelligents" class="dd-item ">
        <a href="/CPP_Learning/chapter5/3-smart-ptrs/">
        Pointeurs intelligents
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter5/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter5/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter6/" title="Algorithmes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter6/">
          <b>6- </b>Algorithmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/1-searches/" title="Parcours et recherches" class="dd-item ">
        <a href="/CPP_Learning/chapter6/1-searches/">
        Parcours et recherches
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/2-transformations/" title="Transformations" class="dd-item ">
        <a href="/CPP_Learning/chapter6/2-transformations/">
        Transformations
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/3-iterators/" title="It√©rateurs" class="dd-item ">
        <a href="/CPP_Learning/chapter6/3-iterators/">
        It√©rateurs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/4-lambdas/" title="Lambdas" class="dd-item ">
        <a href="/CPP_Learning/chapter6/4-lambdas/">
        Lambdas
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter6/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/summary/" title="Synth√®se" class="dd-item ">
        <a href="/CPP_Learning/chapter6/summary/">
        Synth√®se
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter7/" title="Traitement d&#39;erreurs" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter7/">
          <b>7- </b>Traitement d&#39;erreurs
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter7/1-assertions/" title="Assertions" class="dd-item ">
        <a href="/CPP_Learning/chapter7/1-assertions/">
        Assertions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter7/2-exceptions/" title="Exceptions" class="dd-item ">
        <a href="/CPP_Learning/chapter7/2-exceptions/">
        Exceptions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>Acc√®s rapide</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/Laefy/CPP_Learning_Code/"><i class='fab fa-github'></i> D√©p√¥t GitHub</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/workflow"><i class='far fa-list-alt'></i> Workflow</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/faq"><i class='fas fa-question-circle'></i> FAQ</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://en.cppreference.com/w/"><i class='fas fa-passport'></i> CPP-Ref</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Supprimer l&#39;historique</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/CPP_Learning/'>Accueil</a> > <a href='/CPP_Learning/chapter5/'>Gestion des ressources</a> > Ownership
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#un-probl√®me-darchitecture">Un probl√®me d&rsquo;architecture</a></li>
        <li><a href="#exposer-les-couplages">Exposer les couplages</a></li>
        <li><a href="#transferts-downership">Transferts d&rsquo;ownership</a></li>
        <li><a href="#aggr√©gations">Aggr√©gations</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#bonus-et-le-todo-alors-">(Bonus) Et le TODO alors ?</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Ownership
            </h1>
          

        


<hr>
<p>Pour cet exercice, vous modifierez les fichiers :<br>
- <code>chap-05/2-pokemons/Journey.cpp</code><br>
- <code>chap-05/2-pokemons/PC.h</code><br>
- <code>chap-05/2-pokemons/PokeCenter.h</code><br>
- <code>chap-05/2-pokemons/Pokedex.h</code><br>
- <code>chap-05/2-pokemons/Pokemon.h</code><br>
- <code>chap-05/2-pokemons/ProfessorOak.h</code><br>
- <code>chap-05/2-pokemons/Trainer.h</code></p>
<p>La cible √† compiler est <code>c5-2-pokemons</code>.</p>
<hr>

<div class="notices note" ><p>Le terme &ldquo;propri√©t√©&rdquo; est tout √† fait valide pour parler d'&ldquo;ownership&rdquo;, mais nous utiliserons de pr√©f√©rence ce dernier, car &ldquo;propri√©t√©&rdquo; peut aussi √™tre utilis√© pour d√©signer les &ldquo;attributs&rdquo; d&rsquo;un objet.</p>
</div>

<hr>
<h3 id="un-probl√®me-darchitecture">Un probl√®me d&rsquo;architecture</h3>
<p>Comme vous l&rsquo;avez vu dans l&rsquo;exercice pr√©c√©dent, afin de pouvoir lib√©rer une ressource, il faut d&rsquo;abord pr√©venir tous les objets qui la r√©f√©rencent que celle-ci va √™tre d√©truite.</p>
<p>Analysez le code de l&rsquo;exercice et essayez de r√©pondre aux questions suivantes.</p>
<ol>
<li>Quelles sont les classes et les variables du <code>main</code> r√©f√©ren√ßant un objet de type <code>Pokemon</code> ?</li>
<li>A quels endroits fait-on appel au destructeur de <code>Pokemon</code> ?</li>
<li>Pour chacune de ces locations, quels sont les objects du programme pr√©alablement notifi√©s de cette destruction ?</li>
<li>Certains objets ont-ils √©t√© notifi√©s pour rien ?</li>
<li>D&rsquo;autres n&rsquo;ont-ils pas √©t√© notifi√©s alors qu&rsquo;ils auraient d√ª l&rsquo;√™tre ?</li>
<li>Toute la m√©moire a-t-elle correctement √©t√© lib√©r√©e √† la fin du programme ?</li>
</ol>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Toutes les classes r√©f√©rencent des <code>Pokemon</code>: <code>PC::_stored_pokemons</code>, <code>PokeCenter::_traumatized_pokemons</code>, <code>Pokedex::_pokemons</code>, <code>ProfessorOak::_starters</code>, <code>Trainer::_team</code>.<br>
Dans le <code>main</code>, les variables <code>encounter</code>, <code>traumatized</code>, <code>duplicated</code> et <code>pokemon</code> r√©f√©rencent aussi des <code>Pokemon</code>.</p>
<p>Le destructeur de <code>Pokemon</code> n&rsquo;est appel√© qu&rsquo;√† trois endroits : <code>delete encounter</code> et <code>delete pokemon</code> dans le <code>main</code>, ainsi que <code>delete pokemon</code> dans <code>PC::remove</code>.<br>
Le programme est probablement bourr√© de fuites de m√©moire&hellip;</p>
<p>Avant de d√©truire le contenu de <code>encounter</code>, on notifie les dresseurs <code>red</code> et <code>blue</code>.
Pourtant, cela ne semble pas n√©cessaire, puisque cette instruction ne semble √™tre ex√©cut√©e que lorsqu&rsquo;aucun dresseur n&rsquo;attrape le Pok√©mon.</p>
<p>Avant de d√©truire <code>pokemon</code> dans la derni√®re boucle du <code>main</code>, on notifie <code>pc3</code>.
Etant donn√© que <code>pc3</code> n&rsquo;a jamais √©t√© utilis√© pr√©c√©demment dans le <code>main</code>, le notifier n&rsquo;√©tait probablement pas n√©cessaire.</p>
<p>En ce qui concerne <code>PC::remove</code>, la fonction est appel√©e depuis les diverses boucles du <code>main</code>.
Dans la boucle it√©rant sur <code>traumatized</code>, les 2 pok√©dex, les 2 dresseurs principaux et les 2 premiers PCs sont notifi√©s.
Cela para√Æt √†-priori coh√©rent, mais en y regardant de plus pr√®s, on s&rsquo;aper√ßoit que le <code>pokecenter</code> ne conna√Æt que les Pok√©mons de <code>red</code>.
Il n&rsquo;est donc peut-√™tre pas n√©cessaire de notifier <code>blue_pokedex</code> ou <code>blue</code>.<br>
Autre probl√®me, <code>pc1.remove</code> et <code>pc2.remove</code> sont appel√©s sur le m√™me objet.
On aura donc une erreur de double-free si on passe dans cette boucle.</p>
<p>Dans la boucle it√©rant sur <code>duplicated</code>, les 2 dresseurs principaux sont notifi√©s.
Il n&rsquo;√©tait probablement pas n√©cessaire de notifier <code>red</code>, puisque <code>duplicated</code> est obtenu depuis <code>blue_pokedex</code>.
En revanche, il aurait probablement fallu notifier <code>blue_pokedex</code> justement.</p>

    </div>
</div>
<p>Comme vous pouvez le constater, avec du code agenc√© de cette mani√®re, r√©pondre aux questions ci-dessus n&rsquo;est pas une t√¢che ais√©e.
Or, il est n√©cessaire de pouvoir le faire pour s&rsquo;assurer que le programme n&rsquo;est pas bugg√©.</p>
<p>Le premier probl√®me de cette architecture, c&rsquo;est qu&rsquo;il est extr√™mement difficile d&rsquo;identifier qui poss√®de des r√©f√©rences sur une instance particuli√®re d&rsquo;un <code>Pokemon</code> √† un instant donn√© du programme :
<code>pc1</code> ? <code>red._team</code> ? <code>pc1</code> et <code>red._team</code> ? <code>pc1</code> et <code>red._team</code> et <code>pokecenter</code> ? seulement <code>pokecenter</code> ?</p>
<p>Le deuxi√®me probl√®me, c&rsquo;est que m√™me si nous avions cette information, nous ne serions pas capables de d√©terminer qui est suppos√© lib√©rer le bloc de m√©moire allou√© pour un Pok√©mon, ni de pr√©venir de sa destruction imminente les objets qui en d√©pendent.</p>
<p>Pour d√©signer le composant responsable de ces deux missions, on utilise le terme de <strong>propri√©taire</strong> ou <strong>owner</strong>. Pour √™tre tout √† fait pr√©cis, le propri√©taire d&rsquo;une ressource, c&rsquo;est le <strong>composant charg√© de la dur√©e de vie de cette ressource</strong>.
Et du coup, pour s&rsquo;assurer que l&rsquo;on acc√®de toujours √† des ressources valides, et que ces ressources sont bien lib√©r√©es lorsque l&rsquo;on n&rsquo;en a plus besoin, il est n√©cessaire d&rsquo;identifier le propri√©taire de chaque ressource pour v√©rifier qu&rsquo;il fait son travail correctement.</p>
<hr>
<h3 id="exposer-les-couplages">Exposer les couplages</h3>
<p>Lorsqu&rsquo;il n&rsquo;est pas possible d&rsquo;identifier clairement le propri√©taire d&rsquo;une ressource dans un programme, il faut commencer par analyser comment int√©ragissent les composants du programme entre eux.
Cela permet g√©n√©ralement d&rsquo;encapsuler un certain nombre d&rsquo;objets √† l&rsquo;int√©rieur d&rsquo;une m√™me classe et de diviser le probl√®me.</p>
<p>Exemple : dans le code suivant, qui est responsable de <code>res1</code> ?</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">A</span> <span class="n">a</span> <span class="p">{</span> <span class="n">res1</span> <span class="p">};</span>           <span class="c1">// a can be the owner of res1, but it can also be a simple observer of res1 
</span><span class="c1"></span><span class="n">B</span> <span class="n">b</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">};</span>     <span class="c1">// same for b
</span><span class="c1"></span><span class="n">C</span> <span class="n">c</span> <span class="p">{</span> <span class="n">res2</span> <span class="p">};</span>           <span class="c1">// c is definitely not the owner of res1.
</span></code></pre></div><p>En introduisant un type <code>D</code>, qui regroupe A et B :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">D</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">D</span><span class="p">(</span><span class="n">Res</span> <span class="n">res1</span><span class="p">,</span> <span class="n">Res</span> <span class="n">res2</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">a</span> <span class="p">{</span> <span class="n">res1</span> <span class="p">},</span> <span class="n">b</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">}</span>
    <span class="p">{}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Il n&rsquo;y a maintenant plus de doute. Dans le code suivant, c&rsquo;est forc√©ment <code>d</code> qui est responsable de <code>res1</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">D</span> <span class="n">D</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">};</span>     <span class="c1">// no one but d seems to take care of res1, so it needs to be the owner of res1
</span><span class="c1"></span><span class="n">C</span> <span class="n">c</span> <span class="p">{</span> <span class="n">res2</span> <span class="p">};</span>
</code></pre></div><p>Evidemment, pour que √ßa se passe bien, il ne faut pas regrouper n&rsquo;importe quoi.
Il faut essayer de mettre ensemble les objets qui travaillent sur les m√™mes ressources.</p>
<p>En regardant le <code>main</code>, pouvez-vous identifier des couplages entre certains objets ?
C&rsquo;est-√†-dire, quels objets semblent utiliser les m√™mes ressources et travailler conjointement ?</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Le r√©sultat des op√©rations faites sur <code>red</code> n&rsquo;impacte que <code>pc1</code>, celles faites sur <code>blue</code> n&rsquo;impacte que <code>pc2</code>, et celles faites sur <code>some_guy</code> n&rsquo;impacte que <code>pc3</code>.<br>
Il existe donc un couplage entre les instances de <code>Trainer</code> et les instances de <code>PC</code>.</p>
<p>Lorsqu&rsquo;on ajoute un Pok√©mon dans <code>red_pokedex</code>, on ajoute ce m√™me Pok√©mon dans <code>red</code> ou <code>pc1</code>. De m√™me, lorsqu&rsquo;on ajoute un Pok√©mon dans <code>blue_pokedex</code>, on l&rsquo;ajoute √©galement dans <code>blue</code> ou <code>pc2</code>.<br>
Il existe un couplage entre les instances de <code>Trainer</code> / <code>PC</code> et les instances de <code>Pokedex</code>.</p>

    </div>
</div>
<p>Ajoutez deux attributs <code>PC _pc</code> et <code>Pokedex _pokedex</code> √† la classe <code>Trainer</code> afin d&rsquo;exposer clairement ces couplages.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Trainer</span>
<span class="p">{</span>
    <span class="p">...</span>

<span class="k">private</span><span class="o">:</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">_name</span><span class="p">;</span>

    <span class="n">PC</span>                      <span class="n">_pc</span><span class="p">;</span>
    <span class="n">Pokedex</span>                 <span class="n">_pokedex</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*</span><span class="p">,</span> <span class="mi">6</span><span class="o">&gt;</span> <span class="n">_team</span> <span class="p">{</span> <span class="k">nullptr</span> <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
    </div>
</div>

<div class="notices note" ><p>En r√©alisant ce changement, vous venez de d√©signer chaque instance de <code>Trainer</code> comme le propri√©taire du PC et du Pok√©dex avec lesquels elle int√©ragit.
Par transitivit√©, elle est donc aussi propri√©taire des ressources manag√©es par chacun de ces attributs.
Cela signifie qu&rsquo;en toute logique, d√©truire un <code>Trainer</code> permettra d&rsquo;entra√Æner automatiquement la lib√©ration de toutes les ressources qui lui sont directement associ√©es (par exemple, le contenu de <code>_team</code>), mais aussi de celles associ√©es √† chacun de ses attributs (<code>_pc._stored_pokemons</code>).</p>
</div>

<p>Supprimez maintenant les variables de type <code>PC</code> et <code>Pokedex</code> du <code>main</code> et refactorisez le code de mani√®re √† utiliser vos nouveaux attributs √† la place.<br>
Profitez-en pour en retirer les instructions inutiles, par exemple, lorsqu&rsquo;un Pok√©mon est supprim√© d&rsquo;un conteneur dans lequel il ne pouvait de toute mani√®re pas √™tre.<br>
Vous √™tes libre de modifier l√©g√®rement le comportement du programme, du moment que vous n&rsquo;introduisez pas des bugs qui n&rsquo;√©taient pas l√† avant.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p><strong>Consultation du Pok√©dex</strong></p>
<p>On peut ajouter un getter de Pok√©dex dans <code>Trainer</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Dans Trainer:
</span><span class="c1"></span><span class="k">const</span> <span class="n">Pokedex</span><span class="o">&amp;</span> <span class="n">get_pokedex</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_pokedex</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// Dain main:
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">...)</span>
</code></pre></div><hr>
<p><strong>Capture des Pok√©mons</strong></p>
<p>On peut d√©placer les appels √† <code>Pokedex::add</code> et <code>PC::transfer</code> dans <code>Trainer::collect</code>.<br>
On en profite √©galement pour introduire les fonctions priv√©es <code>get_first_pokemon</code> (qui peut aussi √™tre utilis√©e dans <code>get_level</code>) et <code>add_to_team</code> afin de rendre le code plus compr√©hensible.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::collect (public), qui ne plus besoin de retourner un bool:
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="n">fighter</span> <span class="o">=</span> <span class="n">get_first_pokemon</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">fighter</span><span class="o">-&gt;</span><span class="n">level_up</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">_pokedex</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">add_to_team</span><span class="p">(</span><span class="n">pokemon</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Trainer::get_level (public):
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">get_level</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">*</span> <span class="n">pokemon</span> <span class="o">=</span> <span class="n">get_first_pokemon</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">pokemon</span> <span class="o">?</span> <span class="n">pokemon</span><span class="o">-&gt;</span><span class="n">get_level</span><span class="p">()</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Trainer::get_first_pokemon (private):
</span><span class="c1"></span><span class="n">Pokemon</span><span class="o">*</span> <span class="nf">get_first_pokemon</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Trainer::add_to_team (private):
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">add_to_team</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">pokemon</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">try_capture</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">encounter</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">encounter</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">try_capture</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">encounter</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">blue</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">encounter</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="notices info" ><p>Attention, comme <code>Trainer::collect</code> est utilis√© √† deux autres endroits du <code>main</code>, ce changement modifie le comportement du programme (<code>Pikachu</code> et <code>Squirtle</code> appara√Ætront par exemple dans le Pok√©dex de <code>red</code>).
Si vous souhaitez garder l&rsquo;ancien comportement, vous pouvez laisser <code>Trainer::collect</code> tel quel et impl√©menter une nouvelle fonction <code>Trainer::catch_pokemon</code> appelant <code>Pokedex::add</code>, <code>PC::transfer</code> et <code>Trainer::collect</code>.</p>
</div>
<hr>
<p><strong>Pok√©mon non captur√©</strong></p>
<p>Lorsque le pok√©mon n&rsquo;est captur√© par personne, il est √©vident qu&rsquo;il n&rsquo;a √©t√© attribu√© √† aucun des dresseurs.<br>
Les deux instructions au dessus du <code>delete</code> se servent donc √† rien :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">encounter</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Assistance aux Pok√©mons maltrait√©s</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Code pr√©c√©dent:
</span><span class="c1"></span><span class="n">pokecenter</span><span class="p">.</span><span class="n">heal</span><span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokemons</span><span class="p">());</span>

<span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">pc1</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>En ne se basant que sur le code existant, <code>pokecenter</code> ne peut th√©oriquement avoir connaissance que des Pok√©mons de <code>red</code> faisant partie de son √©quipe (<code>get_pokemons</code> renvoie les Pok√©mons de l&rsquo;√©quipe).
Cependant, on voit plus bas qu&rsquo;il est en fait possible de d√©placer les Pok√©mons de l&rsquo;√©quipe vers le PC :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">blue</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">pc2</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>Pour que le nouveau code reste robuste, lorsqu&rsquo;un Pok√©mon est maltrait√© par un dresseur, il faut donc le supprimer de son √©quipe et de son PC.<br>
En effet, un programmeur pourrait tr√®s bien d√©cid√© d&rsquo;ins√©rer du code entre l&rsquo;appel √† <code>PokeCenter::heal</code> et la boucle qui le suit.
Si ce nouveau code r√©alise le transfert des Pok√©mons vers le PC, alors, ils resteront maltrait√©s √† tout jamais üò¢</p>
<p>On commence donc par d√©placer les instructions relatives √† <code>red_pokedex</code> et <code>pc1</code> dans la fonction <code>Trainer::remove</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::remove (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">remove_from_team</span><span class="p">(</span><span class="n">pokemon</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Trainer::remove_from_team (private):
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">pc2</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="notices tip" ><p>Il est clair d&rsquo;apr√®s l&rsquo;impl√©mentation de <code>collect</code> qu&rsquo;un Pok√©mon ne peut pas √™tre dans le PC s&rsquo;il est d√©j√† dans l&rsquo;√©quipe (invariant de classe).
On n&rsquo;est donc pas oblig√© d&rsquo;appeler <code>PC::remove</code> si on a d√©j√† trouv√© le Pok√©mon dans l&rsquo;√©quipe.</p>
</div>
<p>Qu&rsquo;en est-il des instructions relatives √† <code>blue</code> ?
Dans le code actuel, le <code>pokecenter</code> n&rsquo;a jamais connaissance des Pok√©mons de <code>blue</code>.
On pourrait donc se dire que l&rsquo;on peut retirer <code>blue</code> de la boucle sans probl√®me.
Cependant, le code est amen√© √† changer, et quelqu&rsquo;un pourrait d√©cider un jour d&rsquo;ins√©rer l&rsquo;instruction <code>pokecenter.heal(blue.get_pokemons())</code> avant la boucle.<br>
Faut-il donc g√©rer ce potentiel futur cas, et ajouter <code>trainer.remove(pokemon)</code> dans la boucle pour tous les dresseurs du programme ?</p>
<p>La r√©ponse est non.
Mais on ne peut pas non plus laisser le code tel quel, car si on rajoute du code pour soigner d&rsquo;autres Pok√©mons, il faut aussi penser √† ajouter des instructions dans la boucle plus loin.
Ce genre de situation est propice √† l&rsquo;introduction de bugs, et il faudrait donc refactoriser le syst√®me pour coupler plus fortement le fait de soigner les Pok√©mons avec le signalement des cas de maltraitance.</p>
<p>Mais comme on est d√©j√† en plein milieu d&rsquo;un autre refacto, et qu&rsquo;il vaut mieux faire les choses une par une, on ajoute juste un commentaire pour penser √† faire les autres modifications plus tard.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// TODO: make the removal of the traumatized pokemon and the healing strongly coupled. 
</span><span class="c1"></span><span class="n">pokecenter</span><span class="p">.</span><span class="n">heal</span><span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokemons</span><span class="p">());</span>

<span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Transfert des Pok√©mons sur le PC</strong></p>
<p>On pourrait faire un getter pour <code>_pc</code>, mais cela casserait l&rsquo;encapsulation de la classe puisqu&rsquo;il faudrait renvoyer un <code>_pc</code> non constant.
On ne pourrait par exemple plus garantir le fait qu&rsquo;un Pok√©mon ne peut pas √™tre √† la fois dans l&rsquo;√©quipe et le PC.</p>
<p>A la place, on ajoute une fonction <code>Trainer::transfer_team_to_pc</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::transfer_team_to_pc (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">transfer_team_to_pc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">give_pokemons</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="n">blue</span><span class="p">.</span><span class="n">transfer_team_to_pc</span><span class="p">();</span>
</code></pre></div><hr>
<p><strong>Retour √† l&rsquo;√©tat sauvage</strong></p>
<p>Blue √©tant un personnage sans coeur, tout ce qu&rsquo;il l&rsquo;int√©resse, c&rsquo;est de compl√©ter son Pok√©dex et de monter de niveau rapidement.
Par cons√©quent, il capture tous les Pok√©mons qu&rsquo;il rencontre, mais il les rel√¢che plus tard s&rsquo;il les a d√©j√†.
C&rsquo;est un peu comme les p√™cheurs en fait&hellip;</p>
<p>Nous ajoutons donc une nouvelle fonction <code>release_duplicates</code> √† la classe <code>Trainer</code>.<br>
On peut aussi supprimer compl√®tement l&rsquo;instruction <code>red.remove(pokemon)</code>, car les Pok√©mons apparaissant dans le Pok√©dex de Blue ne peuvent pas appartenir √† Red.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::release_duplicates (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">_pokedex</span><span class="p">.</span><span class="n">get_duplicated</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">duplicated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// remove already delegates to all the right components (team / pc / pokedex).
</span><span class="c1"></span>        <span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="n">blue</span><span class="p">.</span><span class="n">release_duplicates</span><span class="p">();</span>
</code></pre></div><hr>
<p><strong>Don de Pok√©mon</strong></p>
<p><code>Trainer::collect</code> prenant maintenant en charge le transfert vers le PC si l&rsquo;√©quipe est pleine, on peut simplement remplacer le contenu de la boucle par :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">some_girl</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Abandon de carri√®re</strong></p>
<p>Etre ma√Ætre Pok√©mon, ce n&rsquo;est pas fait pour tout le monde, et <code>some_guy</code> a donc d√©cid√© qu&rsquo;il valait mieux pour lui qu&rsquo;il arr√™te sa carri√®re et rel√¢che ses Pok√©mons.</p>
<p><code>Trainer::give_pokemons</code> permet d&rsquo;extraire les Pok√©mons faisant partie de l&rsquo;√©quipe d&rsquo;un dresseur.
Or comme un Pok√©mon ne peut pas √™tre sur le PC s&rsquo;il fait partie de l&rsquo;√©quipe, on peut en d√©duire que l&rsquo;instruction <code>pc3.release(pokemon)</code> n&rsquo;a aucun d&rsquo;effet.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">some_guy</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="transferts-downership">Transferts d&rsquo;ownership</h3>
<p>Maintenant qu&rsquo;il est plus simple d&rsquo;identifier quels objets int√©ragissent ensemble, essayez de r√©pondre aux questions suivantes.</p>
<ul>
<li>Quelles lignes de la fonction <code>main</code> r√©alisent un transfert d&rsquo;ownership ?
C&rsquo;est-√†-dire √† quel endroit le propri√©taire d&rsquo;une instance de <code>Pokemon</code> change ?</li>
<li>Quelles lignes de la classe <code>Trainer</code> (fonctions publiques uniquement) r√©alisent un transfert d&rsquo;ownership ?</li>
<li>Pour chacun de ces transferts, qui est l&rsquo;ancien propri√©taire, et qui est le nouveau ?</li>
<li>La classe <code>PokeCenter</code> d√©tient-elle l&rsquo;ownership des instances de <code>Pok√©mon</code> qu&rsquo;elle r√©f√©rencent ?
Pouvez-vous r√©pondre √† cette question en analysant seulement le code de <code>PokeCenter</code> ?</li>
<li>M√™me question pour <code>ProfessorOak</code>.</li>
<li>Pour chacune des classes <code>Trainer</code>, <code>PC</code>, <code>Pokedex</code>, <code>ProfessorOak</code>, <code>PokeCenter</code>, indiquez si elle poss√®de les <code>Pokemons</code> qu&rsquo;elles r√©f√©rencent (= <strong>composition</strong>) ou si elle ne fait que les observer (= <strong>aggr√©gation</strong>).</li>
</ul>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <table>
<thead>
<tr>
<th></th>
<th>Ancien</th>
<th>Nouveau</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Attributions des starters (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>some_guy.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>some_guy</code></td>
</tr>
<tr>
<td><code>blue.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>blue</code></td>
</tr>
<tr>
<td><code>some_girl.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>some_girl</code></td>
</tr>
<tr>
<td><code>red.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><strong>Capture d&rsquo;un Pok√©mon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>auto* encounter = random_encounter()</code></td>
<td><code>random_encounter</code></td>
<td><code>encounter</code></td>
</tr>
<tr>
<td><code>red.collect(encounter)</code></td>
<td><code>encounter</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><code>blue.collect(encounter)</code></td>
<td><code>encounter</code></td>
<td><code>blue</code></td>
</tr>
<tr>
<td><code>delete encounter</code></td>
<td><code>encounter</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Echange de Pok√©mon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : some_girl.give_pokemons())</code></td>
<td><code>some_girl</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>red.collect(pokemon)</code></td>
<td><code>pokemon</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><strong>Suppression de Pok√©mon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : some_guy.give_pokemons())</code></td>
<td><code>some_guy</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>delete pokemon</code></td>
<td><code>pokemon</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Trainer::give_pokemons</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>auto pokemons = get_pokemons() + _team.fill(nullptr)</code></td>
<td><code>_team</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>return pokemons</code></td>
<td><code>pokemons</code></td>
<td>appelant</td>
</tr>
<tr>
<td><strong>Trainer::collect</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>add_to_team(pokemon)</code></td>
<td><code>pokemon</code></td>
<td><code>_team</code></td>
</tr>
<tr>
<td><code>_pc.transfer(pokemon)</code></td>
<td><code>pokemon</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Trainer::transfer_team_to_pc</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : give_pokemons())</code></td>
<td><code>_team</code></td>
<td><code>pokemon</code></td>
</tr>
</tbody>
</table>
<p><strong>PokeCenter n&rsquo;est pas un owner</strong><br>
L&rsquo;instruction <code>pokecenter.heal(red.get_pokemons())</code> ne r√©alise pas de transfert, puisque <code>Trainer::get_pokemons</code> ne c√®de pas l&rsquo;ownership des Pok√©mons de l&rsquo;√©quipe (contrairement √† <code>Trainer::give_pokemons</code>).<br>
<code>PokeCenter::heal</code> recevant un objet qui ne porte pas d&rsquo;ownership, on peut donc en conclure que la classe <code>PokeCenter</code> est suppos√©e √™tre un observeur de <code>Pokemon</code>, et non pas un owner.
Afin de d√©duire cette information, il a √©t√© n√©cessaire d&rsquo;analyser le code du <code>main</code>.
En effet, l&rsquo;attribut <code>PokeCenter::_traumatized_pokemons</code> est exactement du m√™me type que <code>PC::_stored_pokemons</code>, alors que le premier ne porte pas d&rsquo;ownership mais le second oui.</p>
<p><strong>ProfessorOak est bien un owner</strong><br>
La classe <code>ProfessorOak</code> alloue elle-m√™me ses propres instances de Pok√©mons.
<code>ProfessorOak</code> est donc bien owner des Pok√©mons dont il dispose, et on a ce coup-ci pu d√©duire l&rsquo;information directement de l&rsquo;impl√©mentation de la classe.</p>
<p><strong>Conclusion</strong><br>
La relation entre les classes <code>Trainer</code>, <code>PC</code> et <code>ProfessorOak</code> et leurs Pok√©mons est une relation de composition.
En revanche, <code>Pokedex</code> et <code>PokeCenter</code> ne font qu&rsquo;aggr√©ger des Pok√©mons existants ailleurs.</p>

    </div>
</div>
<p>Maintenant que vous √™tes capable de d√©terminer √† tout instant le propri√©taire d&rsquo;un Pok√©mon, vous devriez pouvoir identifier les endroits du programme succeptibles de d√©clencher des fuites de m√©moire et les corriger.
Pour cela, il faut d√©j√† s&rsquo;assurer que le destructeur de chaque classe propri√©taire de ressources s&rsquo;occupe de leur lib√©ration.
Il faut ensuite v√©rifier que lorsqu&rsquo;un transfert d&rsquo;ownership a lieu dans une fonction, soit la fonction s&rsquo;occupe de lib√©rer cette ressource, soit elle retransfert l&rsquo;ownership √† un autre composant.
Enfin, il faut s&rsquo;assurer que d√®s lors qu&rsquo;un owner supprime sa derni√®re r√©f√©rence sur une ressource, soit il la lib√®re pr√©alablement, soit il la retransf√®re √† quelqu&rsquo;un d&rsquo;autre.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Il faut ajouter les destructeurs aux diff√©rentes classes qui ownent des instances de <code>Pokemon</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer.
</span><span class="c1"></span><span class="o">~</span><span class="n">Trainer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// PC
</span><span class="c1"></span><span class="o">~</span><span class="n">PC</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">_stored_pokemons</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ProfessorOak
</span><span class="c1"></span><span class="o">~</span><span class="n">ProfessorOak</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">starter</span> <span class="p">:</span> <span class="n">_starters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">starter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="notices tip" ><p>Il n&rsquo;y a pas besoin de v√©rifier qu&rsquo;un pointeur n&rsquo;est pas nul avant de le <code>delete</code>.
Ecrire <code>delete nullptr</code> est tout √† fait correct. L&rsquo;instruction ne fait juste rien dans ce cas l√†.<br>
C&rsquo;est d&rsquo;√©crire <code>delete ptr</code> avec <code>ptr</code> non nul mais d√©j√† lib√©r√© qui peut g√©n√©rer une segfault.</p>
</div>
<p>Il faut ensuite s&rsquo;assurer que toutes les fonctions qui ont √† un moment re√ßu l&rsquo;ownership d&rsquo;un Pok√©mon l&rsquo;ont soit c√©d√© √† quelqu&rsquo;un d&rsquo;autre, soit ont bien lib√©r√© les ressources qui lui √©taient associ√©es.</p>
<ul>
<li><code>auto* encounter = random_encounter()</code> : <code>main</code> acqui√®re l&rsquo;ownership du r√©sultat de <code>random_encounter</code>. Si l&rsquo;ownership n&rsquo;est pas c√©d√© √† un <code>Trainer</code>, la variable <code>encounter</code> est bien lib√©r√©e.</li>
<li><code>for (auto* pokemon : some_girl.give_pokemons())</code> : <code>main</code> acqui√®re l&rsquo;ownership du r√©sultat de <code>give_pokemons</code>, qu&rsquo;il transf√®re ensuite √† <code>red</code>.</li>
<li><code>for (auto* pokemon : some_guy.give_pokemons())</code> : <code>main</code> acqui√®re l&rsquo;ownership du r√©sultat de <code>give_pokemons</code>, et il en lib√®re la m√©moire.
Il n&rsquo;y a donc pas de probl√®me √† ce niveau l√†.</li>
</ul>
<p>V√©rifions maintenant que chaque fois qu&rsquo;une r√©f√©rence sur un <code>Pokemon</code> est perdue dans les classes qui ownent des Pok√©mons, le Pok√©mon est soit lib√©r√©, soit transf√©r√© √† quelqu&rsquo;un d&rsquo;autre.</p>
<ul>
<li><code>PC::release</code> : lorsqu&rsquo;un √©l√©ment est retir√© <code>_stored_pokemons</code>, le <code>Pokemon</code> associ√© n&rsquo;est pas d√©truit. L&rsquo;ownership de l&rsquo;objet est donc <em>probablement</em> transmis √† la fonction parente.</li>
<li><code>PC::remove</code> : <code>remove</code> est la seule fonction qui appelle <code>release</code> dans le code. Le <code>Pokemon</code> associ√© √† cet appel est effectivement d√©truit. Il n&rsquo;y a donc pas de fuite lors d&rsquo;un appel √† <code>remove</code>.</li>
<li><code>ProfessorOak::get_starter</code> : les √©l√©ments extraient de <code>_starters</code> sont transmis √† la fonction appelante via la valeur de retour.<br>
Cette fonction est utilis√©e uniquement dans <code>main</code>, et les valeurs de retour sont ensuite transmises √† des <code>trainers</code>.</li>
<li><code>Trainer::remove_from_team</code> : les √©l√©ments extraient du tableau ne sont ni lib√©r√©s, ni transf√©r√©s √† qui que ce soit. C&rsquo;est donc √©ventuellement la fonction appelante qui r√©cup√®re l&rsquo;ownership.
Or, dans <code>Trainer::remove</code>, qui est le seul appelant de <code>remove_from_team</code>, la ressource n&rsquo;est pas non plus lib√©r√©e.
Cependant, si le Pok√©mon √† extraire est dans <code>_pc</code> au lieu de <code>_team</code>, il est bien d√©truit, car <code>PC::remove</code> s&rsquo;en charge pour nous. 
Il serait donc logique que <code>Trainer::remove_from_team</code> d√©clenche la destruction du Pok√©mon s&rsquo;il existe, puisque l&rsquo;appelant de <code>Trainer::remove</code> ne peut pas s&rsquo;en charger (le Pok√©mon pourrait d√©j√† avoir √©t√© d√©truit par <code>PC::remove</code>).</li>
<li><code>Trainer::give_pokemons</code> : les √©l√©ments extraits de <code>_team</code> sont transmis √† la fonction appelante via la valeur de retour.</li>
</ul>
<p>On corrige donc la fuite de m√©moire produite par <code>Trainer::remove_from_team</code> en d√©truisant le <code>Pokemon</code> extrait avant de sortir de la fonction.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">to_destroy</span> <span class="o">=</span> <span class="o">*</span><span class="n">it</span><span class="p">;</span>
        <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">to_destroy</span><span class="p">;</span>

        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Les fuites de m√©moire sont plus faciles √† rep√©rer lorsque le transfert d&rsquo;ownership est correctement exprim√© par le code.<br>
H√©las, ce n&rsquo;est pas le cas ici. Typiquement, les fonctions <code>give_pokemons</code> et <code>get_pokemons</code> renvoient la m√™me chose.
Pourtant la premi√®re r√©alise un transfert d&rsquo;ownership alors que l&rsquo;autre non.</p>
<p>Si on appelle <code>get_pokemons()</code> sans stocker le r√©sultat o√π que ce soit, on aura juste fait un appel inutile.
En revanche, si on fait la m√™me chose avec <code>give_pokemons()</code>, on d√©clenche une fuite de m√©moire.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">red</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">();</span> <span class="c1">// fuite de m√©moire √† moins que red._team soit vide
</span></code></pre></div><p>Pour emp√™cher l&rsquo;appelant d&rsquo;une fonction d&rsquo;ignorer son r√©sultat, il est possible d&rsquo;appliquer l&rsquo;attribut <code>[[nodiscard]]</code> sur le type de retour de cette fonction.
Si la valeur de retour de la fonction n&rsquo;est pas utilis√©e, alors le compilateur va d√©clencher une erreur.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="na">[[nodiscard]]</span> <span class="kt">int</span> <span class="n">my_result_is_very_important</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">3</span><span class="p">;</span> <span class="p">}</span> 

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// The following code is correct.
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">my_result_is_very_important</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// This one also.
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">my_result_is_very_important</span><span class="p">();</span>

    <span class="c1">// However, this one triggers an error because the return value of my_result_is_very_important is not used.
</span><span class="c1"></span>    <span class="n">my_result_is_very_important</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<div class="notices note" ><p>Utilisez <code>[[nodiscard]]</code> n&rsquo;emp√™chera pas forc√©ment d&rsquo;avoir des fuites. L&rsquo;appelant peut tr√®s bien stocker le r√©sultat dans une variable, et tout de m√™me oublier de la lib√©rer.
Cependant, l&rsquo;attribut attirera quand m√™me l&rsquo;attention du programmeur, et il y aura donc plus de chances qu&rsquo;il se rende compte qu&rsquo;il doit d√©truire l&rsquo;objet ou le transf√©rer √† quelqu&rsquo;un d&rsquo;autre.</p>
</div>

<p>Ajoutez l&rsquo;attribut <code>[[nodiscard]]</code> sur toutes les fonctions renvoyant une valeur propri√©taire des ressources qu&rsquo;elle r√©f√©rence.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Dans Journey.cpp
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">random_encounter</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Dans ProfessorOak.h
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">get_starter</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Dans Trainer.h
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">give_pokemons</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Modifiez <code>PC::release</code> afin qu&rsquo;elle retourne le Pok√©mon qu&rsquo;elle a retir√© de <code>_stored_pokemons</code>.
Il sera ainsi plus √©vident de comprendre que l&rsquo;appel de la fonction d√©clenche une transmission d&rsquo;ownership.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">release</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">release</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Pokemon</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>

    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="o">*</span><span class="n">it</span><span class="p">);</span> <span class="c1">// &lt;utility&gt;
</span><span class="c1"></span>        <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="aggr√©gations">Aggr√©gations</h3>
<p>Vous avez rendu les transferts d&rsquo;ownership un peu plus clair au niveau des valeurs de retour des fonctions.
Ce serait bien de pouvoir faire la m√™me chose sur les param√®tres.
A d√©faut de savoir comment exprimer un transfert d&rsquo;ownership au niveau d&rsquo;un param√®tre, vous devriez savoir que ce qui permet d&rsquo;exprimer une relation d&rsquo;aggr√©gation (donc r√©f√©rencement sans ownership), ce sont les r√©f√©rences.</p>
<p>Modifiez les signatures des fonctions qui ne r√©cup√®rent pas l&rsquo;ownership de ce qu&rsquo;on leur passe en utilisant des r√©f√©rences plut√¥t que des pointeurs.<br>
Rappel: n&rsquo;essayez par contre pas de remplacer des <code>std::vector&lt;T*&gt;</code> par des <code>std::vector&lt;T&amp;&gt;</code>, cela ne compilera pas.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Il faut bien penser √† reconvertir la r√©f√©rence en pointeur √† l&rsquo;int√©rieur des impl√©mentations l√† o√π cela est n√©cessaire (appel √† std::find, par exemple).</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// PC.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">release</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Pokedex.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">has_duplicate</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">.</span><span class="n">get_name</span><span class="p">());</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Trainer.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">_pokedex</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
        <span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Journey.cpp
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">try_capture</span><span class="p">(</span><span class="k">const</span> <span class="n">Trainer</span><span class="o">&amp;</span> <span class="n">trainer</span><span class="p">,</span> <span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">encounter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">trainer</span><span class="p">.</span><span class="n">get_level</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">encounter</span><span class="p">.</span><span class="n">get_level</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="o">*</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">try_capture</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="o">*</span><span class="n">encounter</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">try_capture</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="o">*</span><span class="n">encounter</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">...</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Comme indiquer plus haut, il n&rsquo;est pas possible de stocker les r√©f√©rences directement dans des conteneurs.
Cependant, la STL propose un petit objet permettant d&rsquo;emballer une r√©f√©rence.
Il s&rsquo;agit de <code>std::reference_wrapper&lt;T&gt;</code>, contenu dans <code>&lt;functional&gt;</code>.
Comme cette classe est r√©assignable, il est possible de l&rsquo;utiliser pour stocker des r√©f√©rences dans des conteneurs.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">A</span> <span class="n">a1</span><span class="p">;</span>
<span class="n">A</span> <span class="n">a2</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">a1_ref</span> <span class="o">=</span> <span class="n">a1</span><span class="p">;</span>

<span class="c1">// On ne peut pas √©crire directement a1_ref.value (car reference_wrapper n&#39;a pas de membre `value`).
</span><span class="c1">// On peut utiliser get() pour r√©cup√©rer la &#34;vraie&#34; r√©f√©rence de type A&amp;.
</span><span class="c1"></span><span class="n">a1_ref</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 3
</span><span class="c1"></span>
<span class="n">a1</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a1_ref</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 6
</span><span class="c1"></span>
<span class="c1">// On peut par contre transformer un reference_wrapper en r√©f√©rence automatiquement via une assignation
</span><span class="c1">// (sans faire get()).
</span><span class="c1"></span><span class="n">A</span><span class="o">&amp;</span> <span class="n">a1_raw_ref</span> <span class="o">=</span> <span class="n">a1_ref</span><span class="p">;</span>

<span class="c1">// On peut aussi passer un reference_wrapper&lt;A&gt; √† une fonction qui attend un A&amp; sans faire de get().
</span><span class="c1"></span><span class="n">fcn</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
<span class="n">fcn</span><span class="p">(</span><span class="n">a1_ref</span><span class="p">);</span>
<span class="n">fcn</span><span class="p">(</span><span class="n">a1_raw_ref</span><span class="p">);</span>

<span class="c1">// Enfin, on peut mettre des reference_wrapper dans des conteneurs.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;&gt;</span> <span class="n">a_refs</span> <span class="p">{</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a_refs</span><span class="p">.</span><span class="n">front</span><span class="p">().</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 6
</span><span class="c1"></span>
<span class="n">a_refs</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">get</span><span class="p">().</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a2</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 2
</span></code></pre></div><p>Remplacez les conteneurs de <code>Pokemon*</code> qui ne porte pas l&rsquo;ownership des Pok√©mons par des conteneurs de <code>std::reference_wrapper&lt;Pokemon&gt;</code>.
Si les pointeurs √©taient constants, vous pouvez dans ce cas utiliser des <code>std::reference_wrapper&lt;const Pokemon&gt;</code>.</p>
<p>Attention par contre √† la recherche : pour trouver un objet particulier dans un conteneur de <code>reference_wrapper</code>, il faut comparer les adresses des objets r√©f√©renc√©s et non pas leur valeur.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Obj</span> <span class="n">obj_or</span><span class="p">;</span>
<span class="n">Obj</span> <span class="n">obj_copy</span> <span class="o">=</span> <span class="n">obj_or</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Obj</span><span class="o">&gt;&gt;</span> <span class="n">objects</span> <span class="p">{</span> <span class="n">obj_copy</span><span class="p">,</span> <span class="n">obj_or</span> <span class="p">};</span>

<span class="c1">// L&#39;instruction suivante retournera obj_copy, car la comparaison utilise Obj::operator==.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">objects</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">obj_or</span><span class="p">);</span>

<span class="c1">// Pour √™tre s√ªr d&#39;obtenir exactement obj_or, et pas n&#39;importe quel objet qui pourrait lui √™tre √©gal,
</span><span class="c1">// il faut utiliser find_if et comparer les adresses.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">objects</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">obj_or</span><span class="p">](</span><span class="k">const</span> <span class="n">Obj</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">obj_or</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">obj</span><span class="p">;</span> <span class="p">});</span>
</code></pre></div><p>N&rsquo;h√©sitez pas √† copier-coller la lambda ci-dessus et √† adapter les noms √† votre contexte, sans trop vous pr√©occuper de la syntaxe.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Pokemon.h
</span><span class="c1"></span><span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pokemon</span><span class="p">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Pokedex.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Pokedex</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">pokemon</span><span class="p">](</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">pokemon</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">;</span> <span class="p">});</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="p">...</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_duplicated</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">result</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">it</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">().</span><span class="n">get_name</span><span class="p">());</span>
            <span class="p">...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">_pokemons</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Trainer.h
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_pokemons</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">pokemons</span><span class="p">;</span>
    <span class="p">...</span>
            <span class="n">pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">give_pokemons</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// On ne peut plus utiliser get_pokemons, puisque le type de retour n&#39;est plus le m√™me plus.
</span><span class="c1"></span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">pokemons</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">_team</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">pokemons</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">_pokedex</span><span class="p">.</span><span class="n">get_duplicated</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">duplicated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// PokeCenter.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PokeCenter</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">heal</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;&amp;</span> <span class="n">pokemons</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Remplace auto* par Pokemon&amp; plut√¥t que auto&amp; pour ne pas avoir √† faire le get() en dessous.
</span><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="n">Pokemon</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">pokemons</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pokemon</span><span class="p">.</span><span class="n">get_level</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_traumatized</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">_traumatized_pokemons</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Journey.cpp
</span><span class="c1"></span><span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="conclusion">Conclusion</h3>
<p>En C++, les probl√®mes de gestion de m√©moire, c&rsquo;est courant :</p>
<ul>
<li>fuite de m√©moire,</li>
<li>acc√®s √† de la m√©moire lib√©r√©e,</li>
<li>√©criture dans de la m√©moire lib√©r√©e,</li>
<li>double free,</li>
<li>acc√®s √† de la m√©moire non-allou√©e, car pointeurs non-initialis√©s,</li>
<li>etc.</li>
</ul>
<p>L&rsquo;objectif de cet exercice, c&rsquo;√©tait de vous faire prendre conscience que plus une ressource est partag√©e dans un programme, plus il est difficile de savoir qui est cens√© la g√©rer.</p>
<p>Du coup, afin de faciliter la compr√©hension du programme et de limiter les erreurs, voil√† ce que vous pouvez appliquer :</p>
<ul>
<li>Faites en sorte qu&rsquo;il soit facile de distinguer si vos fonctions exposent des ressources (comme <code>get_pokemons</code>) ou transf√®rent des ressources (comme <code>give_pokemons</code>).</li>
<li>Faites aussi en sorte qu&rsquo;il soit facile de distinguer si un objet est propri√©taire d&rsquo;une ressource (composition) ou s&rsquo;il ne fait que l&rsquo;utiliser (aggr√©gation).</li>
<li>Si dans une fonction, vous ne souhaitez plus r√©f√©rencer une ressource dont vous avez l&rsquo;ownership :
<ul>
<li>soit vous lib√©rez la ressource,</li>
<li>soit vous placez cette ressource dans la valeur de retour de la fonction, que vous marquez <code>[[nodiscard]]</code>.</li>
</ul>
</li>
<li>Essayez de faire en sorte que les composants qui int√©ragissent ensemble et partagent les m√™mes ressources soient fortement coupl√©s.
Cela permet de notifier plus facilement les d√©pendances d&rsquo;une ressource avant qu&rsquo;elle ne soit lib√©r√©e.</li>
</ul>
<hr>
<h3 id="bonus-et-le-todo-alors-">(Bonus) Et le TODO alors ?</h3>
<p>Si vous avez envie, vous pouvez modifier la fonction <code>PokeCenter::heal</code> afin de faire en sorte que les Pok√©mons maltrait√©s soient secourus au cours de l&rsquo;appel de la fonction.
Vous devriez du coup pouvoir supprimer enti√®rement les membres <code>get_traumatized</code> et <code>_traumatized_pokemons</code> de la classe <code>PokeCenter</code>.</p>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/CPP_Learning/chapter5/1-lifespan/" title="Dur√©e de vie"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/CPP_Learning/chapter5/3-smart-ptrs/" title="Pointeurs intelligents" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/CPP_Learning/js/clipboard.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.jquery.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/jquery.sticky.js?1616215070"></script>
    <script src="/CPP_Learning/js/featherlight.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/highlight.pack.js?1616215070"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/CPP_Learning/js/modernizr.custom-3.6.0.js?1616215070"></script>
    <script src="/CPP_Learning/js/learn.js?1616215070"></script>
    <script src="/CPP_Learning/js/hugo-learn.js?1616215070"></script>

    <link href="/CPP_Learning/mermaid/mermaid.css?1616215070" rel="stylesheet" />
    <script src="/CPP_Learning/mermaid/mermaid.js?1616215070"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

