<!DOCTYPE html>
<html lang="fr" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="">


    <link rel="icon" href="/CPP_Learning/images/favicon.png" type="image/png">

    <title>Ownership :: Cours de C&#43;&#43; - Niveau Master</title>

    
    <link href="/CPP_Learning/css/nucleus.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/fontawesome-all.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/hybrid.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/featherlight.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/perfect-scrollbar.min.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/auto-complete.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/atom-one-dark-reasonable.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/theme.css?1616215070" rel="stylesheet">
    <link href="/CPP_Learning/css/hugo-theme.css?1616215070" rel="stylesheet">
    
    <link href="/CPP_Learning/css/theme-mine.css?1616215070" rel="stylesheet">
    
    <link href="/CPP_Learning/css/syntax.css?1616215070" rel="stylesheet">

    <script src="/CPP_Learning/js/jquery-3.3.1.min.js?1616215070"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/CPP_Learning/chapter5/2-ownership/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://laefy.github.io/CPP_Learning/">🥞 C++ 🥞</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Rechercher...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/CPP_Learning/js/lunr.min.js?1616215070"></script>
<script type="text/javascript" src="/CPP_Learning/js/auto-complete.js?1616215070"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/laefy.github.io\/CPP_Learning\/";
    
</script>
<script type="text/javascript" src="/CPP_Learning/js/search.js?1616215070"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/" title="Introduction au C&#43;&#43;" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/">
          <b>1- </b>Introduction au C&#43;&#43;
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/1-language/" title="Présentation du langage" class="dd-item ">
        <a href="/CPP_Learning/chapter1/1-language/">
        Présentation du langage
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/2-tools/" title="Outils" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/2-tools/">
          Outils
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/1-vscode/" title="Visual Studio Code" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/1-vscode/">
        Visual Studio Code
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/2-cmake/" title="CMake" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/2-cmake/">
        CMake
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/3-git/" title="Git" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/3-git/">
        Git
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/2-tools/4-compilation/" title="Compilation &amp; Exécution" class="dd-item ">
        <a href="/CPP_Learning/chapter1/2-tools/4-compilation/">
        Compilation &amp; Exécution
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/CPP_Learning/chapter1/3-practice/" title="Premiers programmes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter1/3-practice/">
          Premiers programmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/1-hello-world/" title="👋 Hello World" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/1-hello-world/">
        👋 Hello World
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/2-parrot.fd/" title="🦜 Perroquet" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/2-parrot.fd/">
        🦜 Perroquet
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/3-array/" title="🔢 Tableau Numérique" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/3-array/">
        🔢 Tableau Numérique
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/3-practice/4-calculator/" title="🧮 Calculette" class="dd-item ">
        <a href="/CPP_Learning/chapter1/3-practice/4-calculator/">
        🧮 Calculette
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter1/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter1/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter1/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter2/" title="Classes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter2/">
          <b>2- </b>Classes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/1-poo/" title="C&#39;est quoi un objet déjà ?" class="dd-item ">
        <a href="/CPP_Learning/chapter2/1-poo/">
        C&#39;est quoi un objet déjà ?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/2-first-class/" title="✨ Première classe" class="dd-item ">
        <a href="/CPP_Learning/chapter2/2-first-class/">
        ✨ Première classe
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/3-constructor/" title="🔨 Constructeur" class="dd-item ">
        <a href="/CPP_Learning/chapter2/3-constructor/">
        🔨 Constructeur
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/4-clone/" title="🧬 Clône" class="dd-item ">
        <a href="/CPP_Learning/chapter2/4-clone/">
        🧬 Clône
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/5-rectangle/" title="🔳 Rectangle" class="dd-item ">
        <a href="/CPP_Learning/chapter2/5-rectangle/">
        🔳 Rectangle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/6-polygon/" title="💠 Polygône" class="dd-item ">
        <a href="/CPP_Learning/chapter2/6-polygon/">
        💠 Polygône
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter2/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter2/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter2/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter3/" title="Conteneurs standards" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter3/">
          <b>3- </b>Conteneurs standards
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/1-doc/" title="Un peu de doc..." class="dd-item ">
        <a href="/CPP_Learning/chapter3/1-doc/">
        Un peu de doc...
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/2-vectors/" title="Tableaux dynamiques" class="dd-item ">
        <a href="/CPP_Learning/chapter3/2-vectors/">
        Tableaux dynamiques
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/3-sequentials/" title="Autres conteneurs séquentiels" class="dd-item ">
        <a href="/CPP_Learning/chapter3/3-sequentials/">
        Autres conteneurs séquentiels
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/4-associatives/" title="Conteneurs associatifs" class="dd-item ">
        <a href="/CPP_Learning/chapter3/4-associatives/">
        Conteneurs associatifs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/5-strings/" title="Manipulation de chaînes" class="dd-item ">
        <a href="/CPP_Learning/chapter3/5-strings/">
        Manipulation de chaînes
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/6-tuples/" title="Paires et tuples" class="dd-item ">
        <a href="/CPP_Learning/chapter3/6-tuples/">
        Paires et tuples
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter3/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter3/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter3/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter4/" title="Héritage" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter4/">
          <b>4- </b>Héritage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/1-hierarchy/" title="💼 Hiérarchie professionnelle" class="dd-item ">
        <a href="/CPP_Learning/chapter4/1-hierarchy/">
        💼 Hiérarchie professionnelle
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/2-farm/" title="🐮 Concerto animalier" class="dd-item ">
        <a href="/CPP_Learning/chapter4/2-farm/">
        🐮 Concerto animalier
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/3-virtual/" title="Résolution d&#39;appel virtuel" class="dd-item ">
        <a href="/CPP_Learning/chapter4/3-virtual/">
        Résolution d&#39;appel virtuel
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/4-polymorphism/" title="Polymorphisme" class="dd-item ">
        <a href="/CPP_Learning/chapter4/4-polymorphism/">
        Polymorphisme
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/5-vehicles/" title="🚗 Véhicule partagé" class="dd-item ">
        <a href="/CPP_Learning/chapter4/5-vehicles/">
        🚗 Véhicule partagé
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter4/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter4/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter4/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter5/" title="Gestion des ressources" class="dd-item 
        parent
        
        
        ">
      <a href="/CPP_Learning/chapter5/">
          <b>5- </b>Gestion des ressources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/1-lifespan/" title="Durée de vie" class="dd-item ">
        <a href="/CPP_Learning/chapter5/1-lifespan/">
        Durée de vie
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/2-ownership/" title="Ownership" class="dd-item active">
        <a href="/CPP_Learning/chapter5/2-ownership/">
        Ownership
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/3-smart-ptrs/" title="Pointeurs intelligents" class="dd-item ">
        <a href="/CPP_Learning/chapter5/3-smart-ptrs/">
        Pointeurs intelligents
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter5/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter5/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter5/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter6/" title="Algorithmes" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter6/">
          <b>6- </b>Algorithmes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/1-searches/" title="Parcours et recherches" class="dd-item ">
        <a href="/CPP_Learning/chapter6/1-searches/">
        Parcours et recherches
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/2-transformations/" title="Transformations" class="dd-item ">
        <a href="/CPP_Learning/chapter6/2-transformations/">
        Transformations
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/3-iterators/" title="Itérateurs" class="dd-item ">
        <a href="/CPP_Learning/chapter6/3-iterators/">
        Itérateurs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/4-lambdas/" title="Lambdas" class="dd-item ">
        <a href="/CPP_Learning/chapter6/4-lambdas/">
        Lambdas
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/test/" title="Questionnaire !" class="dd-item ">
        <a href="/CPP_Learning/chapter6/test/">
        Questionnaire !
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter6/summary/" title="Synthèse" class="dd-item ">
        <a href="/CPP_Learning/chapter6/summary/">
        Synthèse
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/CPP_Learning/chapter7/" title="Traitement d&#39;erreurs" class="dd-item 
        
        
        
        ">
      <a href="/CPP_Learning/chapter7/">
          <b>7- </b>Traitement d&#39;erreurs
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter7/1-assertions/" title="Assertions" class="dd-item ">
        <a href="/CPP_Learning/chapter7/1-assertions/">
        Assertions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/CPP_Learning/chapter7/2-exceptions/" title="Exceptions" class="dd-item ">
        <a href="/CPP_Learning/chapter7/2-exceptions/">
        Exceptions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>Accès rapide</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/Laefy/CPP_Learning_Code/"><i class='fab fa-github'></i> Dépôt GitHub</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/workflow"><i class='far fa-list-alt'></i> Workflow</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://laefy.github.io/CPP_Learning/faq"><i class='fas fa-question-circle'></i> FAQ</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://en.cppreference.com/w/"><i class='fas fa-passport'></i> CPP-Ref</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Supprimer l&#39;historique</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/CPP_Learning/'>Accueil</a> > <a href='/CPP_Learning/chapter5/'>Gestion des ressources</a> > Ownership
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#un-problème-darchitecture">Un problème d&rsquo;architecture</a></li>
        <li><a href="#exposer-les-couplages">Exposer les couplages</a></li>
        <li><a href="#transferts-downership">Transferts d&rsquo;ownership</a></li>
        <li><a href="#aggrégations">Aggrégations</a></li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#bonus-et-le-todo-alors-">(Bonus) Et le TODO alors ?</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Ownership
            </h1>
          

        


<hr>
<p>Pour cet exercice, vous modifierez les fichiers :<br>
- <code>chap-05/2-pokemons/Journey.cpp</code><br>
- <code>chap-05/2-pokemons/PC.h</code><br>
- <code>chap-05/2-pokemons/PokeCenter.h</code><br>
- <code>chap-05/2-pokemons/Pokedex.h</code><br>
- <code>chap-05/2-pokemons/Pokemon.h</code><br>
- <code>chap-05/2-pokemons/ProfessorOak.h</code><br>
- <code>chap-05/2-pokemons/Trainer.h</code></p>
<p>La cible à compiler est <code>c5-2-pokemons</code>.</p>
<hr>

<div class="notices note" ><p>Le terme &ldquo;propriété&rdquo; est tout à fait valide pour parler d'&ldquo;ownership&rdquo;, mais nous utiliserons de préférence ce dernier, car &ldquo;propriété&rdquo; peut aussi être utilisé pour désigner les &ldquo;attributs&rdquo; d&rsquo;un objet.</p>
</div>

<hr>
<h3 id="un-problème-darchitecture">Un problème d&rsquo;architecture</h3>
<p>Comme vous l&rsquo;avez vu dans l&rsquo;exercice précédent, afin de pouvoir libérer une ressource, il faut d&rsquo;abord prévenir tous les objets qui la référencent que celle-ci va être détruite.</p>
<p>Analysez le code de l&rsquo;exercice et essayez de répondre aux questions suivantes.</p>
<ol>
<li>Quelles sont les classes et les variables du <code>main</code> référençant un objet de type <code>Pokemon</code> ?</li>
<li>A quels endroits fait-on appel au destructeur de <code>Pokemon</code> ?</li>
<li>Pour chacune de ces locations, quels sont les objects du programme préalablement notifiés de cette destruction ?</li>
<li>Certains objets ont-ils été notifiés pour rien ?</li>
<li>D&rsquo;autres n&rsquo;ont-ils pas été notifiés alors qu&rsquo;ils auraient dû l&rsquo;être ?</li>
<li>Toute la mémoire a-t-elle correctement été libérée à la fin du programme ?</li>
</ol>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Toutes les classes référencent des <code>Pokemon</code>: <code>PC::_stored_pokemons</code>, <code>PokeCenter::_traumatized_pokemons</code>, <code>Pokedex::_pokemons</code>, <code>ProfessorOak::_starters</code>, <code>Trainer::_team</code>.<br>
Dans le <code>main</code>, les variables <code>encounter</code>, <code>traumatized</code>, <code>duplicated</code> et <code>pokemon</code> référencent aussi des <code>Pokemon</code>.</p>
<p>Le destructeur de <code>Pokemon</code> n&rsquo;est appelé qu&rsquo;à trois endroits : <code>delete encounter</code> et <code>delete pokemon</code> dans le <code>main</code>, ainsi que <code>delete pokemon</code> dans <code>PC::remove</code>.<br>
Le programme est probablement bourré de fuites de mémoire&hellip;</p>
<p>Avant de détruire le contenu de <code>encounter</code>, on notifie les dresseurs <code>red</code> et <code>blue</code>.
Pourtant, cela ne semble pas nécessaire, puisque cette instruction ne semble être exécutée que lorsqu&rsquo;aucun dresseur n&rsquo;attrape le Pokémon.</p>
<p>Avant de détruire <code>pokemon</code> dans la dernière boucle du <code>main</code>, on notifie <code>pc3</code>.
Etant donné que <code>pc3</code> n&rsquo;a jamais été utilisé précédemment dans le <code>main</code>, le notifier n&rsquo;était probablement pas nécessaire.</p>
<p>En ce qui concerne <code>PC::remove</code>, la fonction est appelée depuis les diverses boucles du <code>main</code>.
Dans la boucle itérant sur <code>traumatized</code>, les 2 pokédex, les 2 dresseurs principaux et les 2 premiers PCs sont notifiés.
Cela paraît à-priori cohérent, mais en y regardant de plus près, on s&rsquo;aperçoit que le <code>pokecenter</code> ne connaît que les Pokémons de <code>red</code>.
Il n&rsquo;est donc peut-être pas nécessaire de notifier <code>blue_pokedex</code> ou <code>blue</code>.<br>
Autre problème, <code>pc1.remove</code> et <code>pc2.remove</code> sont appelés sur le même objet.
On aura donc une erreur de double-free si on passe dans cette boucle.</p>
<p>Dans la boucle itérant sur <code>duplicated</code>, les 2 dresseurs principaux sont notifiés.
Il n&rsquo;était probablement pas nécessaire de notifier <code>red</code>, puisque <code>duplicated</code> est obtenu depuis <code>blue_pokedex</code>.
En revanche, il aurait probablement fallu notifier <code>blue_pokedex</code> justement.</p>

    </div>
</div>
<p>Comme vous pouvez le constater, avec du code agencé de cette manière, répondre aux questions ci-dessus n&rsquo;est pas une tâche aisée.
Or, il est nécessaire de pouvoir le faire pour s&rsquo;assurer que le programme n&rsquo;est pas buggé.</p>
<p>Le premier problème de cette architecture, c&rsquo;est qu&rsquo;il est extrêmement difficile d&rsquo;identifier qui possède des références sur une instance particulière d&rsquo;un <code>Pokemon</code> à un instant donné du programme :
<code>pc1</code> ? <code>red._team</code> ? <code>pc1</code> et <code>red._team</code> ? <code>pc1</code> et <code>red._team</code> et <code>pokecenter</code> ? seulement <code>pokecenter</code> ?</p>
<p>Le deuxième problème, c&rsquo;est que même si nous avions cette information, nous ne serions pas capables de déterminer qui est supposé libérer le bloc de mémoire alloué pour un Pokémon, ni de prévenir de sa destruction imminente les objets qui en dépendent.</p>
<p>Pour désigner le composant responsable de ces deux missions, on utilise le terme de <strong>propriétaire</strong> ou <strong>owner</strong>. Pour être tout à fait précis, le propriétaire d&rsquo;une ressource, c&rsquo;est le <strong>composant chargé de la durée de vie de cette ressource</strong>.
Et du coup, pour s&rsquo;assurer que l&rsquo;on accède toujours à des ressources valides, et que ces ressources sont bien libérées lorsque l&rsquo;on n&rsquo;en a plus besoin, il est nécessaire d&rsquo;identifier le propriétaire de chaque ressource pour vérifier qu&rsquo;il fait son travail correctement.</p>
<hr>
<h3 id="exposer-les-couplages">Exposer les couplages</h3>
<p>Lorsqu&rsquo;il n&rsquo;est pas possible d&rsquo;identifier clairement le propriétaire d&rsquo;une ressource dans un programme, il faut commencer par analyser comment intéragissent les composants du programme entre eux.
Cela permet généralement d&rsquo;encapsuler un certain nombre d&rsquo;objets à l&rsquo;intérieur d&rsquo;une même classe et de diviser le problème.</p>
<p>Exemple : dans le code suivant, qui est responsable de <code>res1</code> ?</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">A</span> <span class="n">a</span> <span class="p">{</span> <span class="n">res1</span> <span class="p">};</span>           <span class="c1">// a can be the owner of res1, but it can also be a simple observer of res1 
</span><span class="c1"></span><span class="n">B</span> <span class="n">b</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">};</span>     <span class="c1">// same for b
</span><span class="c1"></span><span class="n">C</span> <span class="n">c</span> <span class="p">{</span> <span class="n">res2</span> <span class="p">};</span>           <span class="c1">// c is definitely not the owner of res1.
</span></code></pre></div><p>En introduisant un type <code>D</code>, qui regroupe A et B :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">D</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">D</span><span class="p">(</span><span class="n">Res</span> <span class="n">res1</span><span class="p">,</span> <span class="n">Res</span> <span class="n">res2</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">a</span> <span class="p">{</span> <span class="n">res1</span> <span class="p">},</span> <span class="n">b</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">}</span>
    <span class="p">{}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">A</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Il n&rsquo;y a maintenant plus de doute. Dans le code suivant, c&rsquo;est forcément <code>d</code> qui est responsable de <code>res1</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">D</span> <span class="n">D</span> <span class="p">{</span> <span class="n">res1</span><span class="p">,</span> <span class="n">res2</span> <span class="p">};</span>     <span class="c1">// no one but d seems to take care of res1, so it needs to be the owner of res1
</span><span class="c1"></span><span class="n">C</span> <span class="n">c</span> <span class="p">{</span> <span class="n">res2</span> <span class="p">};</span>
</code></pre></div><p>Evidemment, pour que ça se passe bien, il ne faut pas regrouper n&rsquo;importe quoi.
Il faut essayer de mettre ensemble les objets qui travaillent sur les mêmes ressources.</p>
<p>En regardant le <code>main</code>, pouvez-vous identifier des couplages entre certains objets ?
C&rsquo;est-à-dire, quels objets semblent utiliser les mêmes ressources et travailler conjointement ?</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Le résultat des opérations faites sur <code>red</code> n&rsquo;impacte que <code>pc1</code>, celles faites sur <code>blue</code> n&rsquo;impacte que <code>pc2</code>, et celles faites sur <code>some_guy</code> n&rsquo;impacte que <code>pc3</code>.<br>
Il existe donc un couplage entre les instances de <code>Trainer</code> et les instances de <code>PC</code>.</p>
<p>Lorsqu&rsquo;on ajoute un Pokémon dans <code>red_pokedex</code>, on ajoute ce même Pokémon dans <code>red</code> ou <code>pc1</code>. De même, lorsqu&rsquo;on ajoute un Pokémon dans <code>blue_pokedex</code>, on l&rsquo;ajoute également dans <code>blue</code> ou <code>pc2</code>.<br>
Il existe un couplage entre les instances de <code>Trainer</code> / <code>PC</code> et les instances de <code>Pokedex</code>.</p>

    </div>
</div>
<p>Ajoutez deux attributs <code>PC _pc</code> et <code>Pokedex _pokedex</code> à la classe <code>Trainer</code> afin d&rsquo;exposer clairement ces couplages.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">class</span> <span class="nc">Trainer</span>
<span class="p">{</span>
    <span class="p">...</span>

<span class="k">private</span><span class="o">:</span>
    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">_name</span><span class="p">;</span>

    <span class="n">PC</span>                      <span class="n">_pc</span><span class="p">;</span>
    <span class="n">Pokedex</span>                 <span class="n">_pokedex</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*</span><span class="p">,</span> <span class="mi">6</span><span class="o">&gt;</span> <span class="n">_team</span> <span class="p">{</span> <span class="k">nullptr</span> <span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
    </div>
</div>

<div class="notices note" ><p>En réalisant ce changement, vous venez de désigner chaque instance de <code>Trainer</code> comme le propriétaire du PC et du Pokédex avec lesquels elle intéragit.
Par transitivité, elle est donc aussi propriétaire des ressources managées par chacun de ces attributs.
Cela signifie qu&rsquo;en toute logique, détruire un <code>Trainer</code> permettra d&rsquo;entraîner automatiquement la libération de toutes les ressources qui lui sont directement associées (par exemple, le contenu de <code>_team</code>), mais aussi de celles associées à chacun de ses attributs (<code>_pc._stored_pokemons</code>).</p>
</div>

<p>Supprimez maintenant les variables de type <code>PC</code> et <code>Pokedex</code> du <code>main</code> et refactorisez le code de manière à utiliser vos nouveaux attributs à la place.<br>
Profitez-en pour en retirer les instructions inutiles, par exemple, lorsqu&rsquo;un Pokémon est supprimé d&rsquo;un conteneur dans lequel il ne pouvait de toute manière pas être.<br>
Vous êtes libre de modifier légèrement le comportement du programme, du moment que vous n&rsquo;introduisez pas des bugs qui n&rsquo;étaient pas là avant.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p><strong>Consultation du Pokédex</strong></p>
<p>On peut ajouter un getter de Pokédex dans <code>Trainer</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Dans Trainer:
</span><span class="c1"></span><span class="k">const</span> <span class="n">Pokedex</span><span class="o">&amp;</span> <span class="n">get_pokedex</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_pokedex</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// Dain main:
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">...)</span>
</code></pre></div><hr>
<p><strong>Capture des Pokémons</strong></p>
<p>On peut déplacer les appels à <code>Pokedex::add</code> et <code>PC::transfer</code> dans <code>Trainer::collect</code>.<br>
On en profite également pour introduire les fonctions privées <code>get_first_pokemon</code> (qui peut aussi être utilisée dans <code>get_level</code>) et <code>add_to_team</code> afin de rendre le code plus compréhensible.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::collect (public), qui ne plus besoin de retourner un bool:
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="n">fighter</span> <span class="o">=</span> <span class="n">get_first_pokemon</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">fighter</span><span class="o">-&gt;</span><span class="n">level_up</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">_pokedex</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">add_to_team</span><span class="p">(</span><span class="n">pokemon</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Trainer::get_level (public):
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">get_level</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span><span class="o">*</span> <span class="n">pokemon</span> <span class="o">=</span> <span class="n">get_first_pokemon</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">pokemon</span> <span class="o">?</span> <span class="n">pokemon</span><span class="o">-&gt;</span><span class="n">get_level</span><span class="p">()</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Trainer::get_first_pokemon (private):
</span><span class="c1"></span><span class="n">Pokemon</span><span class="o">*</span> <span class="nf">get_first_pokemon</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">t</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Trainer::add_to_team (private):
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">add_to_team</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">pokemon</span><span class="p">;</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">try_capture</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="n">encounter</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">encounter</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">try_capture</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">encounter</span><span class="p">))</span>
<span class="p">{</span>
    <span class="n">blue</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">encounter</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="notices info" ><p>Attention, comme <code>Trainer::collect</code> est utilisé à deux autres endroits du <code>main</code>, ce changement modifie le comportement du programme (<code>Pikachu</code> et <code>Squirtle</code> apparaîtront par exemple dans le Pokédex de <code>red</code>).
Si vous souhaitez garder l&rsquo;ancien comportement, vous pouvez laisser <code>Trainer::collect</code> tel quel et implémenter une nouvelle fonction <code>Trainer::catch_pokemon</code> appelant <code>Pokedex::add</code>, <code>PC::transfer</code> et <code>Trainer::collect</code>.</p>
</div>
<hr>
<p><strong>Pokémon non capturé</strong></p>
<p>Lorsque le pokémon n&rsquo;est capturé par personne, il est évident qu&rsquo;il n&rsquo;a été attribué à aucun des dresseurs.<br>
Les deux instructions au dessus du <code>delete</code> se servent donc à rien :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">else</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">encounter</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Assistance aux Pokémons maltraités</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Code précédent:
</span><span class="c1"></span><span class="n">pokecenter</span><span class="p">.</span><span class="n">heal</span><span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokemons</span><span class="p">());</span>

<span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>

<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">pc1</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>En ne se basant que sur le code existant, <code>pokecenter</code> ne peut théoriquement avoir connaissance que des Pokémons de <code>red</code> faisant partie de son équipe (<code>get_pokemons</code> renvoie les Pokémons de l&rsquo;équipe).
Cependant, on voit plus bas qu&rsquo;il est en fait possible de déplacer les Pokémons de l&rsquo;équipe vers le PC :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">blue</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">pc2</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>Pour que le nouveau code reste robuste, lorsqu&rsquo;un Pokémon est maltraité par un dresseur, il faut donc le supprimer de son équipe et de son PC.<br>
En effet, un programmeur pourrait très bien décidé d&rsquo;insérer du code entre l&rsquo;appel à <code>PokeCenter::heal</code> et la boucle qui le suit.
Si ce nouveau code réalise le transfert des Pokémons vers le PC, alors, ils resteront maltraités à tout jamais 😢</p>
<p>On commence donc par déplacer les instructions relatives à <code>red_pokedex</code> et <code>pc1</code> dans la fonction <code>Trainer::remove</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::remove (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">remove_from_team</span><span class="p">(</span><span class="n">pokemon</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Trainer::remove_from_team (private):
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue_pokedex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">blue</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="n">pc2</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="notices tip" ><p>Il est clair d&rsquo;après l&rsquo;implémentation de <code>collect</code> qu&rsquo;un Pokémon ne peut pas être dans le PC s&rsquo;il est déjà dans l&rsquo;équipe (invariant de classe).
On n&rsquo;est donc pas obligé d&rsquo;appeler <code>PC::remove</code> si on a déjà trouvé le Pokémon dans l&rsquo;équipe.</p>
</div>
<p>Qu&rsquo;en est-il des instructions relatives à <code>blue</code> ?
Dans le code actuel, le <code>pokecenter</code> n&rsquo;a jamais connaissance des Pokémons de <code>blue</code>.
On pourrait donc se dire que l&rsquo;on peut retirer <code>blue</code> de la boucle sans problème.
Cependant, le code est amené à changer, et quelqu&rsquo;un pourrait décider un jour d&rsquo;insérer l&rsquo;instruction <code>pokecenter.heal(blue.get_pokemons())</code> avant la boucle.<br>
Faut-il donc gérer ce potentiel futur cas, et ajouter <code>trainer.remove(pokemon)</code> dans la boucle pour tous les dresseurs du programme ?</p>
<p>La réponse est non.
Mais on ne peut pas non plus laisser le code tel quel, car si on rajoute du code pour soigner d&rsquo;autres Pokémons, il faut aussi penser à ajouter des instructions dans la boucle plus loin.
Ce genre de situation est propice à l&rsquo;introduction de bugs, et il faudrait donc refactoriser le système pour coupler plus fortement le fait de soigner les Pokémons avec le signalement des cas de maltraitance.</p>
<p>Mais comme on est déjà en plein milieu d&rsquo;un autre refacto, et qu&rsquo;il vaut mieux faire les choses une par une, on ajoute juste un commentaire pour penser à faire les autres modifications plus tard.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// TODO: make the removal of the traumatized pokemon and the healing strongly coupled. 
</span><span class="c1"></span><span class="n">pokecenter</span><span class="p">.</span><span class="n">heal</span><span class="p">(</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokemons</span><span class="p">());</span>

<span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Transfert des Pokémons sur le PC</strong></p>
<p>On pourrait faire un getter pour <code>_pc</code>, mais cela casserait l&rsquo;encapsulation de la classe puisqu&rsquo;il faudrait renvoyer un <code>_pc</code> non constant.
On ne pourrait par exemple plus garantir le fait qu&rsquo;un Pokémon ne peut pas être à la fois dans l&rsquo;équipe et le PC.</p>
<p>A la place, on ajoute une fonction <code>Trainer::transfer_team_to_pc</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::transfer_team_to_pc (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">transfer_team_to_pc</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">give_pokemons</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">_pc</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="n">blue</span><span class="p">.</span><span class="n">transfer_team_to_pc</span><span class="p">();</span>
</code></pre></div><hr>
<p><strong>Retour à l&rsquo;état sauvage</strong></p>
<p>Blue étant un personnage sans coeur, tout ce qu&rsquo;il l&rsquo;intéresse, c&rsquo;est de compléter son Pokédex et de monter de niveau rapidement.
Par conséquent, il capture tous les Pokémons qu&rsquo;il rencontre, mais il les relâche plus tard s&rsquo;il les a déjà.
C&rsquo;est un peu comme les pêcheurs en fait&hellip;</p>
<p>Nous ajoutons donc une nouvelle fonction <code>release_duplicates</code> à la classe <code>Trainer</code>.<br>
On peut aussi supprimer complètement l&rsquo;instruction <code>red.remove(pokemon)</code>, car les Pokémons apparaissant dans le Pokédex de Blue ne peuvent pas appartenir à Red.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer::release_duplicates (public):
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">_pokedex</span><span class="p">.</span><span class="n">get_duplicated</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">duplicated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// remove already delegates to all the right components (team / pc / pokedex).
</span><span class="c1"></span>        <span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Dans main:
</span><span class="c1"></span><span class="n">blue</span><span class="p">.</span><span class="n">release_duplicates</span><span class="p">();</span>
</code></pre></div><hr>
<p><strong>Don de Pokémon</strong></p>
<p><code>Trainer::collect</code> prenant maintenant en charge le transfert vers le PC si l&rsquo;équipe est pleine, on peut simplement remplacer le contenu de la boucle par :</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">some_girl</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">collect</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><hr>
<p><strong>Abandon de carrière</strong></p>
<p>Etre maître Pokémon, ce n&rsquo;est pas fait pour tout le monde, et <code>some_guy</code> a donc décidé qu&rsquo;il valait mieux pour lui qu&rsquo;il arrête sa carrière et relâche ses Pokémons.</p>
<p><code>Trainer::give_pokemons</code> permet d&rsquo;extraire les Pokémons faisant partie de l&rsquo;équipe d&rsquo;un dresseur.
Or comme un Pokémon ne peut pas être sur le PC s&rsquo;il fait partie de l&rsquo;équipe, on peut en déduire que l&rsquo;instruction <code>pc3.release(pokemon)</code> n&rsquo;a aucun d&rsquo;effet.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">some_guy</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="transferts-downership">Transferts d&rsquo;ownership</h3>
<p>Maintenant qu&rsquo;il est plus simple d&rsquo;identifier quels objets intéragissent ensemble, essayez de répondre aux questions suivantes.</p>
<ul>
<li>Quelles lignes de la fonction <code>main</code> réalisent un transfert d&rsquo;ownership ?
C&rsquo;est-à-dire à quel endroit le propriétaire d&rsquo;une instance de <code>Pokemon</code> change ?</li>
<li>Quelles lignes de la classe <code>Trainer</code> (fonctions publiques uniquement) réalisent un transfert d&rsquo;ownership ?</li>
<li>Pour chacun de ces transferts, qui est l&rsquo;ancien propriétaire, et qui est le nouveau ?</li>
<li>La classe <code>PokeCenter</code> détient-elle l&rsquo;ownership des instances de <code>Pokémon</code> qu&rsquo;elle référencent ?
Pouvez-vous répondre à cette question en analysant seulement le code de <code>PokeCenter</code> ?</li>
<li>Même question pour <code>ProfessorOak</code>.</li>
<li>Pour chacune des classes <code>Trainer</code>, <code>PC</code>, <code>Pokedex</code>, <code>ProfessorOak</code>, <code>PokeCenter</code>, indiquez si elle possède les <code>Pokemons</code> qu&rsquo;elles référencent (= <strong>composition</strong>) ou si elle ne fait que les observer (= <strong>aggrégation</strong>).</li>
</ul>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <table>
<thead>
<tr>
<th></th>
<th>Ancien</th>
<th>Nouveau</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Attributions des starters (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>some_guy.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>some_guy</code></td>
</tr>
<tr>
<td><code>blue.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>blue</code></td>
</tr>
<tr>
<td><code>some_girl.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>some_girl</code></td>
</tr>
<tr>
<td><code>red.collect(oak.get_starter())</code></td>
<td><code>oak</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><strong>Capture d&rsquo;un Pokémon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>auto* encounter = random_encounter()</code></td>
<td><code>random_encounter</code></td>
<td><code>encounter</code></td>
</tr>
<tr>
<td><code>red.collect(encounter)</code></td>
<td><code>encounter</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><code>blue.collect(encounter)</code></td>
<td><code>encounter</code></td>
<td><code>blue</code></td>
</tr>
<tr>
<td><code>delete encounter</code></td>
<td><code>encounter</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Echange de Pokémon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : some_girl.give_pokemons())</code></td>
<td><code>some_girl</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>red.collect(pokemon)</code></td>
<td><code>pokemon</code></td>
<td><code>red</code></td>
</tr>
<tr>
<td><strong>Suppression de Pokémon (main)</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : some_guy.give_pokemons())</code></td>
<td><code>some_guy</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>delete pokemon</code></td>
<td><code>pokemon</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Trainer::give_pokemons</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>auto pokemons = get_pokemons() + _team.fill(nullptr)</code></td>
<td><code>_team</code></td>
<td><code>pokemon</code></td>
</tr>
<tr>
<td><code>return pokemons</code></td>
<td><code>pokemons</code></td>
<td>appelant</td>
</tr>
<tr>
<td><strong>Trainer::collect</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>add_to_team(pokemon)</code></td>
<td><code>pokemon</code></td>
<td><code>_team</code></td>
</tr>
<tr>
<td><code>_pc.transfer(pokemon)</code></td>
<td><code>pokemon</code></td>
<td>-</td>
</tr>
<tr>
<td><strong>Trainer::transfer_team_to_pc</strong></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>for (auto* pokemon : give_pokemons())</code></td>
<td><code>_team</code></td>
<td><code>pokemon</code></td>
</tr>
</tbody>
</table>
<p><strong>PokeCenter n&rsquo;est pas un owner</strong><br>
L&rsquo;instruction <code>pokecenter.heal(red.get_pokemons())</code> ne réalise pas de transfert, puisque <code>Trainer::get_pokemons</code> ne cède pas l&rsquo;ownership des Pokémons de l&rsquo;équipe (contrairement à <code>Trainer::give_pokemons</code>).<br>
<code>PokeCenter::heal</code> recevant un objet qui ne porte pas d&rsquo;ownership, on peut donc en conclure que la classe <code>PokeCenter</code> est supposée être un observeur de <code>Pokemon</code>, et non pas un owner.
Afin de déduire cette information, il a été nécessaire d&rsquo;analyser le code du <code>main</code>.
En effet, l&rsquo;attribut <code>PokeCenter::_traumatized_pokemons</code> est exactement du même type que <code>PC::_stored_pokemons</code>, alors que le premier ne porte pas d&rsquo;ownership mais le second oui.</p>
<p><strong>ProfessorOak est bien un owner</strong><br>
La classe <code>ProfessorOak</code> alloue elle-même ses propres instances de Pokémons.
<code>ProfessorOak</code> est donc bien owner des Pokémons dont il dispose, et on a ce coup-ci pu déduire l&rsquo;information directement de l&rsquo;implémentation de la classe.</p>
<p><strong>Conclusion</strong><br>
La relation entre les classes <code>Trainer</code>, <code>PC</code> et <code>ProfessorOak</code> et leurs Pokémons est une relation de composition.
En revanche, <code>Pokedex</code> et <code>PokeCenter</code> ne font qu&rsquo;aggréger des Pokémons existants ailleurs.</p>

    </div>
</div>
<p>Maintenant que vous êtes capable de déterminer à tout instant le propriétaire d&rsquo;un Pokémon, vous devriez pouvoir identifier les endroits du programme succeptibles de déclencher des fuites de mémoire et les corriger.
Pour cela, il faut déjà s&rsquo;assurer que le destructeur de chaque classe propriétaire de ressources s&rsquo;occupe de leur libération.
Il faut ensuite vérifier que lorsqu&rsquo;un transfert d&rsquo;ownership a lieu dans une fonction, soit la fonction s&rsquo;occupe de libérer cette ressource, soit elle retransfert l&rsquo;ownership à un autre composant.
Enfin, il faut s&rsquo;assurer que dès lors qu&rsquo;un owner supprime sa dernière référence sur une ressource, soit il la libère préalablement, soit il la retransfère à quelqu&rsquo;un d&rsquo;autre.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Il faut ajouter les destructeurs aux différentes classes qui ownent des instances de <code>Pokemon</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Trainer.
</span><span class="c1"></span><span class="o">~</span><span class="n">Trainer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// PC
</span><span class="c1"></span><span class="o">~</span><span class="n">PC</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">_stored_pokemons</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">pokemon</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ProfessorOak
</span><span class="c1"></span><span class="o">~</span><span class="n">ProfessorOak</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">starter</span> <span class="p">:</span> <span class="n">_starters</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">starter</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="notices tip" ><p>Il n&rsquo;y a pas besoin de vérifier qu&rsquo;un pointeur n&rsquo;est pas nul avant de le <code>delete</code>.
Ecrire <code>delete nullptr</code> est tout à fait correct. L&rsquo;instruction ne fait juste rien dans ce cas là.<br>
C&rsquo;est d&rsquo;écrire <code>delete ptr</code> avec <code>ptr</code> non nul mais déjà libéré qui peut générer une segfault.</p>
</div>
<p>Il faut ensuite s&rsquo;assurer que toutes les fonctions qui ont à un moment reçu l&rsquo;ownership d&rsquo;un Pokémon l&rsquo;ont soit cédé à quelqu&rsquo;un d&rsquo;autre, soit ont bien libéré les ressources qui lui étaient associées.</p>
<ul>
<li><code>auto* encounter = random_encounter()</code> : <code>main</code> acquière l&rsquo;ownership du résultat de <code>random_encounter</code>. Si l&rsquo;ownership n&rsquo;est pas cédé à un <code>Trainer</code>, la variable <code>encounter</code> est bien libérée.</li>
<li><code>for (auto* pokemon : some_girl.give_pokemons())</code> : <code>main</code> acquière l&rsquo;ownership du résultat de <code>give_pokemons</code>, qu&rsquo;il transfère ensuite à <code>red</code>.</li>
<li><code>for (auto* pokemon : some_guy.give_pokemons())</code> : <code>main</code> acquière l&rsquo;ownership du résultat de <code>give_pokemons</code>, et il en libère la mémoire.
Il n&rsquo;y a donc pas de problème à ce niveau là.</li>
</ul>
<p>Vérifions maintenant que chaque fois qu&rsquo;une référence sur un <code>Pokemon</code> est perdue dans les classes qui ownent des Pokémons, le Pokémon est soit libéré, soit transféré à quelqu&rsquo;un d&rsquo;autre.</p>
<ul>
<li><code>PC::release</code> : lorsqu&rsquo;un élément est retiré <code>_stored_pokemons</code>, le <code>Pokemon</code> associé n&rsquo;est pas détruit. L&rsquo;ownership de l&rsquo;objet est donc <em>probablement</em> transmis à la fonction parente.</li>
<li><code>PC::remove</code> : <code>remove</code> est la seule fonction qui appelle <code>release</code> dans le code. Le <code>Pokemon</code> associé à cet appel est effectivement détruit. Il n&rsquo;y a donc pas de fuite lors d&rsquo;un appel à <code>remove</code>.</li>
<li><code>ProfessorOak::get_starter</code> : les éléments extraient de <code>_starters</code> sont transmis à la fonction appelante via la valeur de retour.<br>
Cette fonction est utilisée uniquement dans <code>main</code>, et les valeurs de retour sont ensuite transmises à des <code>trainers</code>.</li>
<li><code>Trainer::remove_from_team</code> : les éléments extraient du tableau ne sont ni libérés, ni transférés à qui que ce soit. C&rsquo;est donc éventuellement la fonction appelante qui récupère l&rsquo;ownership.
Or, dans <code>Trainer::remove</code>, qui est le seul appelant de <code>remove_from_team</code>, la ressource n&rsquo;est pas non plus libérée.
Cependant, si le Pokémon à extraire est dans <code>_pc</code> au lieu de <code>_team</code>, il est bien détruit, car <code>PC::remove</code> s&rsquo;en charge pour nous. 
Il serait donc logique que <code>Trainer::remove_from_team</code> déclenche la destruction du Pokémon s&rsquo;il existe, puisque l&rsquo;appelant de <code>Trainer::remove</code> ne peut pas s&rsquo;en charger (le Pokémon pourrait déjà avoir été détruit par <code>PC::remove</code>).</li>
<li><code>Trainer::give_pokemons</code> : les éléments extraits de <code>_team</code> sont transmis à la fonction appelante via la valeur de retour.</li>
</ul>
<p>On corrige donc la fuite de mémoire produite par <code>Trainer::remove_from_team</code> en détruisant le <code>Pokemon</code> extrait avant de sortir de la fonction.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">to_destroy</span> <span class="o">=</span> <span class="o">*</span><span class="n">it</span><span class="p">;</span>
        <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">to_destroy</span><span class="p">;</span>

        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Les fuites de mémoire sont plus faciles à repérer lorsque le transfert d&rsquo;ownership est correctement exprimé par le code.<br>
Hélas, ce n&rsquo;est pas le cas ici. Typiquement, les fonctions <code>give_pokemons</code> et <code>get_pokemons</code> renvoient la même chose.
Pourtant la première réalise un transfert d&rsquo;ownership alors que l&rsquo;autre non.</p>
<p>Si on appelle <code>get_pokemons()</code> sans stocker le résultat où que ce soit, on aura juste fait un appel inutile.
En revanche, si on fait la même chose avec <code>give_pokemons()</code>, on déclenche une fuite de mémoire.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">red</span><span class="p">.</span><span class="n">give_pokemons</span><span class="p">();</span> <span class="c1">// fuite de mémoire à moins que red._team soit vide
</span></code></pre></div><p>Pour empêcher l&rsquo;appelant d&rsquo;une fonction d&rsquo;ignorer son résultat, il est possible d&rsquo;appliquer l&rsquo;attribut <code>[[nodiscard]]</code> sur le type de retour de cette fonction.
Si la valeur de retour de la fonction n&rsquo;est pas utilisée, alors le compilateur va déclencher une erreur.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="na">[[nodiscard]]</span> <span class="kt">int</span> <span class="n">my_result_is_very_important</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">3</span><span class="p">;</span> <span class="p">}</span> 

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// The following code is correct.
</span><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">my_result_is_very_important</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="c1">// This one also.
</span><span class="c1"></span>    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">my_result_is_very_important</span><span class="p">();</span>

    <span class="c1">// However, this one triggers an error because the return value of my_result_is_very_important is not used.
</span><span class="c1"></span>    <span class="n">my_result_is_very_important</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<div class="notices note" ><p>Utilisez <code>[[nodiscard]]</code> n&rsquo;empêchera pas forcément d&rsquo;avoir des fuites. L&rsquo;appelant peut très bien stocker le résultat dans une variable, et tout de même oublier de la libérer.
Cependant, l&rsquo;attribut attirera quand même l&rsquo;attention du programmeur, et il y aura donc plus de chances qu&rsquo;il se rende compte qu&rsquo;il doit détruire l&rsquo;objet ou le transférer à quelqu&rsquo;un d&rsquo;autre.</p>
</div>

<p>Ajoutez l&rsquo;attribut <code>[[nodiscard]]</code> sur toutes les fonctions renvoyant une valeur propriétaire des ressources qu&rsquo;elle référence.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Dans Journey.cpp
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">random_encounter</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Dans ProfessorOak.h
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">get_starter</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="c1">// Dans Trainer.h
</span><span class="c1"></span><span class="na">[[nodiscard]]</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">give_pokemons</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Modifiez <code>PC::release</code> afin qu&rsquo;elle retourne le Pokémon qu&rsquo;elle a retiré de <code>_stored_pokemons</code>.
Il sera ainsi plus évident de comprendre que l&rsquo;appel de la fonction déclenche une transmission d&rsquo;ownership.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solutions
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">release</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">release</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Pokemon</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>

    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="o">*</span><span class="n">it</span><span class="p">);</span> <span class="c1">// &lt;utility&gt;
</span><span class="c1"></span>        <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="aggrégations">Aggrégations</h3>
<p>Vous avez rendu les transferts d&rsquo;ownership un peu plus clair au niveau des valeurs de retour des fonctions.
Ce serait bien de pouvoir faire la même chose sur les paramètres.
A défaut de savoir comment exprimer un transfert d&rsquo;ownership au niveau d&rsquo;un paramètre, vous devriez savoir que ce qui permet d&rsquo;exprimer une relation d&rsquo;aggrégation (donc référencement sans ownership), ce sont les références.</p>
<p>Modifiez les signatures des fonctions qui ne récupèrent pas l&rsquo;ownership de ce qu&rsquo;on leur passe en utilisant des références plutôt que des pointeurs.<br>
Rappel: n&rsquo;essayez par contre pas de remplacer des <code>std::vector&lt;T*&gt;</code> par des <code>std::vector&lt;T&amp;&gt;</code>, cela ne compilera pas.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p>Il faut bien penser à reconvertir la référence en pointeur à l&rsquo;intérieur des implémentations là où cela est nécessaire (appel à std::find, par exemple).</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// PC.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">Pokemon</span><span class="o">*</span> <span class="n">release</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_stored_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Pokedex.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">has_duplicate</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">pokemon</span><span class="p">.</span><span class="n">get_name</span><span class="p">());</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Trainer.h
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">collect</span><span class="p">(</span><span class="n">Pokemon</span><span class="o">*</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">_pokedex</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
        <span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">remove_from_team</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">_team</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_team</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="c1">// Journey.cpp
</span><span class="c1"></span><span class="kt">bool</span> <span class="nf">try_capture</span><span class="p">(</span><span class="k">const</span> <span class="n">Trainer</span><span class="o">&amp;</span> <span class="n">trainer</span><span class="p">,</span> <span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">encounter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">trainer</span><span class="p">.</span><span class="n">get_level</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">encounter</span><span class="p">.</span><span class="n">get_level</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">red</span><span class="p">.</span><span class="n">get_pokedex</span><span class="p">().</span><span class="n">has_duplicate</span><span class="p">(</span><span class="o">*</span><span class="n">encounter</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">try_capture</span><span class="p">(</span><span class="n">red</span><span class="p">,</span> <span class="o">*</span><span class="n">encounter</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">try_capture</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="o">*</span><span class="n">encounter</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">...</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<p>Comme indiquer plus haut, il n&rsquo;est pas possible de stocker les références directement dans des conteneurs.
Cependant, la STL propose un petit objet permettant d&rsquo;emballer une référence.
Il s&rsquo;agit de <code>std::reference_wrapper&lt;T&gt;</code>, contenu dans <code>&lt;functional&gt;</code>.
Comme cette classe est réassignable, il est possible de l&rsquo;utiliser pour stocker des références dans des conteneurs.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">A</span> <span class="n">a1</span><span class="p">;</span>
<span class="n">A</span> <span class="n">a2</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">a1_ref</span> <span class="o">=</span> <span class="n">a1</span><span class="p">;</span>

<span class="c1">// On ne peut pas écrire directement a1_ref.value (car reference_wrapper n&#39;a pas de membre `value`).
</span><span class="c1">// On peut utiliser get() pour récupérer la &#34;vraie&#34; référence de type A&amp;.
</span><span class="c1"></span><span class="n">a1_ref</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a1</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 3
</span><span class="c1"></span>
<span class="n">a1</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a1_ref</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 6
</span><span class="c1"></span>
<span class="c1">// On peut par contre transformer un reference_wrapper en référence automatiquement via une assignation
</span><span class="c1">// (sans faire get()).
</span><span class="c1"></span><span class="n">A</span><span class="o">&amp;</span> <span class="n">a1_raw_ref</span> <span class="o">=</span> <span class="n">a1_ref</span><span class="p">;</span>

<span class="c1">// On peut aussi passer un reference_wrapper&lt;A&gt; à une fonction qui attend un A&amp; sans faire de get().
</span><span class="c1"></span><span class="n">fcn</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
<span class="n">fcn</span><span class="p">(</span><span class="n">a1_ref</span><span class="p">);</span>
<span class="n">fcn</span><span class="p">(</span><span class="n">a1_raw_ref</span><span class="p">);</span>

<span class="c1">// Enfin, on peut mettre des reference_wrapper dans des conteneurs.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;&gt;</span> <span class="n">a_refs</span> <span class="p">{</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="p">};</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a_refs</span><span class="p">.</span><span class="n">front</span><span class="p">().</span><span class="n">get</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 6
</span><span class="c1"></span>
<span class="n">a_refs</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">get</span><span class="p">().</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a2</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// -&gt; 2
</span></code></pre></div><p>Remplacez les conteneurs de <code>Pokemon*</code> qui ne porte pas l&rsquo;ownership des Pokémons par des conteneurs de <code>std::reference_wrapper&lt;Pokemon&gt;</code>.
Si les pointeurs étaient constants, vous pouvez dans ce cas utiliser des <code>std::reference_wrapper&lt;const Pokemon&gt;</code>.</p>
<p>Attention par contre à la recherche : pour trouver un objet particulier dans un conteneur de <code>reference_wrapper</code>, il faut comparer les adresses des objets référencés et non pas leur valeur.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">Obj</span> <span class="n">obj_or</span><span class="p">;</span>
<span class="n">Obj</span> <span class="n">obj_copy</span> <span class="o">=</span> <span class="n">obj_or</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Obj</span><span class="o">&gt;&gt;</span> <span class="n">objects</span> <span class="p">{</span> <span class="n">obj_copy</span><span class="p">,</span> <span class="n">obj_or</span> <span class="p">};</span>

<span class="c1">// L&#39;instruction suivante retournera obj_copy, car la comparaison utilise Obj::operator==.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">objects</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">obj_or</span><span class="p">);</span>

<span class="c1">// Pour être sûr d&#39;obtenir exactement obj_or, et pas n&#39;importe quel objet qui pourrait lui être égal,
</span><span class="c1">// il faut utiliser find_if et comparer les adresses.
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">objects</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">objects</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">obj_or</span><span class="p">](</span><span class="k">const</span> <span class="n">Obj</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">obj_or</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">obj</span><span class="p">;</span> <span class="p">});</span>
</code></pre></div><p>N&rsquo;hésitez pas à copier-coller la lambda ci-dessus et à adapter les noms à votre contexte, sans trop vous préoccuper de la syntaxe.</p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Solution
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="c1">// Pokemon.h
</span><span class="c1"></span><span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pokemon</span><span class="p">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Pokedex.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">Pokedex</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">pokemon</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">pokemon</span><span class="p">](</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">pokemon</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">;</span> <span class="p">});</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="p">...</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_duplicated</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">result</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">it</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_pokemons</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">().</span><span class="n">get_name</span><span class="p">());</span>
            <span class="p">...</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">_pokemons</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Trainer.h
</span><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_pokemons</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">pokemons</span><span class="p">;</span>
    <span class="p">...</span>
            <span class="n">pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="na">[[nodiscard]]</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">give_pokemons</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// On ne peut plus utiliser get_pokemons, puisque le type de retour n&#39;est plus le même plus.
</span><span class="c1"></span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">*&gt;</span> <span class="n">pokemons</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">*</span> <span class="nl">t</span> <span class="p">:</span> <span class="n">_team</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">pokemons</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">_team</span><span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">pokemons</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">release_duplicates</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">duplicated</span> <span class="o">=</span> <span class="n">_pokedex</span><span class="p">.</span><span class="n">get_duplicated</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">duplicated</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// PokeCenter.h
</span><span class="c1"></span><span class="k">class</span> <span class="nc">PokeCenter</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">heal</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;&amp;</span> <span class="n">pokemons</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Remplace auto* par Pokemon&amp; plutôt que auto&amp; pour ne pas avoir à faire le get() en dessous.
</span><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="n">Pokemon</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">pokemons</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pokemon</span><span class="p">.</span><span class="n">get_level</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">get_traumatized</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="n">Pokemon</span><span class="o">&gt;&gt;</span> <span class="n">_traumatized_pokemons</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Journey.cpp
</span><span class="c1"></span><span class="k">const</span> <span class="k">auto</span> <span class="n">traumatized</span> <span class="o">=</span> <span class="n">pokecenter</span><span class="p">.</span><span class="n">get_traumatized</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">pokemon</span> <span class="p">:</span> <span class="n">traumatized</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">red</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pokemon</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
    </div>
</div>
<hr>
<h3 id="conclusion">Conclusion</h3>
<p>En C++, les problèmes de gestion de mémoire, c&rsquo;est courant :</p>
<ul>
<li>fuite de mémoire,</li>
<li>accès à de la mémoire libérée,</li>
<li>écriture dans de la mémoire libérée,</li>
<li>double free,</li>
<li>accès à de la mémoire non-allouée, car pointeurs non-initialisés,</li>
<li>etc.</li>
</ul>
<p>L&rsquo;objectif de cet exercice, c&rsquo;était de vous faire prendre conscience que plus une ressource est partagée dans un programme, plus il est difficile de savoir qui est censé la gérer.</p>
<p>Du coup, afin de faciliter la compréhension du programme et de limiter les erreurs, voilà ce que vous pouvez appliquer :</p>
<ul>
<li>Faites en sorte qu&rsquo;il soit facile de distinguer si vos fonctions exposent des ressources (comme <code>get_pokemons</code>) ou transfèrent des ressources (comme <code>give_pokemons</code>).</li>
<li>Faites aussi en sorte qu&rsquo;il soit facile de distinguer si un objet est propriétaire d&rsquo;une ressource (composition) ou s&rsquo;il ne fait que l&rsquo;utiliser (aggrégation).</li>
<li>Si dans une fonction, vous ne souhaitez plus référencer une ressource dont vous avez l&rsquo;ownership :
<ul>
<li>soit vous libérez la ressource,</li>
<li>soit vous placez cette ressource dans la valeur de retour de la fonction, que vous marquez <code>[[nodiscard]]</code>.</li>
</ul>
</li>
<li>Essayez de faire en sorte que les composants qui intéragissent ensemble et partagent les mêmes ressources soient fortement couplés.
Cela permet de notifier plus facilement les dépendances d&rsquo;une ressource avant qu&rsquo;elle ne soit libérée.</li>
</ul>
<hr>
<h3 id="bonus-et-le-todo-alors-">(Bonus) Et le TODO alors ?</h3>
<p>Si vous avez envie, vous pouvez modifier la fonction <code>PokeCenter::heal</code> afin de faire en sorte que les Pokémons maltraités soient secourus au cours de l&rsquo;appel de la fonction.
Vous devriez du coup pouvoir supprimer entièrement les membres <code>get_traumatized</code> et <code>_traumatized_pokemons</code> de la classe <code>PokeCenter</code>.</p>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/CPP_Learning/chapter5/1-lifespan/" title="Durée de vie"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/CPP_Learning/chapter5/3-smart-ptrs/" title="Pointeurs intelligents" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/CPP_Learning/js/clipboard.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/perfect-scrollbar.jquery.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/jquery.sticky.js?1616215070"></script>
    <script src="/CPP_Learning/js/featherlight.min.js?1616215070"></script>
    <script src="/CPP_Learning/js/highlight.pack.js?1616215070"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/CPP_Learning/js/modernizr.custom-3.6.0.js?1616215070"></script>
    <script src="/CPP_Learning/js/learn.js?1616215070"></script>
    <script src="/CPP_Learning/js/hugo-learn.js?1616215070"></script>

    <link href="/CPP_Learning/mermaid/mermaid.css?1616215070" rel="stylesheet" />
    <script src="/CPP_Learning/mermaid/mermaid.js?1616215070"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

